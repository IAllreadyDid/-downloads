ееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееее AP33    MAC                BDOS3   SPR   M	
       BIOS3   SPR                  BIOSKRN MAC   Y     BIOSKRN REL                  BOOT    MAC    !"              BOOT    REL   #                CHARIO  MAC   /$%&'()          
;         db 63     ; BLM
;         db 7      ; EXM
;         db 127,0  ; DSM
;         db 127,0  ; DRM
;         db 128    ; AL0
;         db 0      ; AL1
;         db 0,128  ; CKS
;         db 0,0    ; OFF
;         db 1      ; PSH
;         d      ; memory card address bits 0-7
REG2    equ 0E081H+slot        ; memory card address bits 8-15
REG3    equ 0E082H+slot        ; memory card address bits 16-18
DTA8    equ 0E083H+slot        ; memory card data port

        include DSKIOB65.LIB    MOVE    REL   d                MULTIO  MAC   ef               OHO512  MAC   ghij             SCB     MAC   klm              SCB     REL   n               ееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееее    db 0      ; HBANK  (GENCPM option)


    ; Disk Parameter Block (DPB)

mdSS8:            ; 256K Byte Version
        db 0,2    ; SPT
        db 4      ; BSH
        db 15     ; BLM
        db 1      ; EXM
        db 127,0  ; DSM
        db 1ееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееее CHARIO  REL   *                CONFIG  LIB   +,               CPM     SUB   -                CPM3    DOC   s./0123456789:;<  CPM3    SYS   J=>?@ABCDEF       DEVICE65LIB   G                DISKIO  MAC   8HIJKLMN          DISKIO  REL   O                    dw dummy  ; md$init
        db slot   ; UNIT (controller relative drive: slot*16+drive)
        db 0      ; TYPE (density support)
xdphM:
        dw 0      ; XLT
        db 0,0,0  ; -0-
        db 0,0,0  ;
        db 0,0,0  ;
        db 0     ; define 6502 disk data i/o block

    ; Disk drive dispatching table for linked BIOS

        public xdphM


    ; Extended Disk Parameter Header (XDPH)

        dw mdwt   ; md$write
        dw mdrd   ; md$read
        dw dummy  ; md$login
   ееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееее27,0  ; DRM
        db 192    ; AL0
        db 0      ; AL1
        db 0,128  ; CKS
        db 0,0    ; OFF
        db 1      ; PSH
        db 1      ; PHM

; mdSS16:           ; 1M Byte Version
;         db 0,2    ; SPT
;         db 6      ; BSH        title 'IBS AP33 Memory Disk Driver'

        ; Rev. 11/24/88
        ; by Werner K.G. Muenchheimer, 5469 Windhagen


        .Z80
        cseg
        org 0

slot    equ 050H               ; hardware slot offset
REG1    equ 0E080H+slot   DRVTBL  MAC   P                DRVTBL  REL   Q                DSKIOB65LIB   	RS               GENCPM  DAT   TUV              HDIO    MAC   3WXYZ[\]          MB192   MAC   ^_`a             MODEBAUDLIB   b                MOVE    MAC   c                ; MF
        dw mdSS8  ; DPB
        dw 0FFFEH ; CSV    (GENCPM option)
        dw 0FFFEH ; ALV    (GENCPM option)
        dw 0FFFEH ; DIRBCB (GENCPM option)
        dw 0FFFEH ; DTABCB (GENCPM option)
        dw 0FFFEH ; HASH   (GENCPM option)
    ееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееb 1      ; PHM


    ; memory disk driver

mdrd:
        XOR  A
        JR   mdrw

mdwt:
        LD   A,1

mdrw:
        LD   (@cmd),A    ; save command
        LD   HL,DTA8

        LD   A,(@mdfrm)
        LD   D,0E5H
        CP   D     ЏбБГме:·КJ!·–2НГ!5ВГJхx№Ъ4сЕеНяГJс#wЕеOНЏбБ:ПжВT~юxВTюКВГHбp!  "єГIНяГЛy<Кѓ<Кz<К€ГяН›В&ГЛН›·ИНSГЛН6яГЛН9яГЛлMDГт:ПТИ!Ее:юКНя·ИН	яюКы2ЇЙГЛН°2zЙ>ГЛzЈ<*ПКГл"ПЙ!УzЈ<~КЛsЙл^#V#N#Fлx±ИЕеN:Я     Њл"Ылy2ЯюЪ7 !  "Ѕ:Ъ2Ж:ж=К7 !” ~·К7 №КН#Г* {2Г!  "z"Э9"Л1м !dеyю3Т\ K!м Гn юЂТ‚ЦbЪ&юТ&!R_ ^#V*Ылй Е!p		^#VлН¦Б:з·АГј!"( COPR. '82 DRI 151282ЗЗЗЗЗЗЗЗЗЗЗЗЗЗЗЗЗЗЗЗЗЗЗЗЗЗЗЗЗЗЗЗЗЗЗЗЗЗЗЗЗЗЗЗЗЗЗЗЗЗЗЗЗЗЗЗЗЗЗЗЗЗИ^ dяяjЋ”љ LD   A,(@trk)
        LD   (REG3),A
        LD   A,(@sect)
        LD   (REG2),A
        LD   DE,(@dma)
        LD   B,0

        LD   A,(@cmd)   ; restore command
        OR   A
        JR   NZ,wt

rd:
        LD   A,B        ; read data
   ПТ
>ѕИxюКюКw>ЙЇwЙМ%ДяЙ:ПжВ7!Ф>®жwЙЇЙ:Я=КяxжВяГя:·Вr:ПжGЕ:Я=ДЅБЕН9Бx·ВrЕ:Ф·ДяБy!·юИ4ю Р5~·ИyюВ‰5ЙюА6 ЙyНЊТ х^НIсц@O:Я=КЇ:ПжВIyю	ВI НI:·жВµЙНЛ НяГя#НIНи:·!ѕР НIГШНI
ГI!У
ѕИЕOН БГееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееее     ; 1st access ?
        JR   Z,mdsrt

        XOR  A
        LD   (REG3),A
        LD   BC,0F00H   ; clear directory
mdini:
        LD   A,B
        LD   (REG2),A
        LD   A,C
        LD   (REG1),A
        LD   (HL),D
        LD   (REG1Н?ВъБХН™НsбА!  ·ИюИлЙББ!яяЙбе 	Н?В+>ђбе 	wГНsИю ЪъВXю*К]w#·Й6?#т]Й	 .,:;[]=<>| е!eѕКѓ45#Вx·бИюaШю{ТЏж_жЙp#В’Йю К™ю	К™ЙеНи:МЖA2'НтБГт!эяГЕ!юя"¬Гя  !  9"1!>еНХН%:жх2ѕН·В5:Яю!ФКНс=Вдg +5ёМ(.7@‰Џ•›ў‘«±ЅЗЫднUуООд&ОО%*gyДк‚&оч&%2ОGPФвоо+QB4    ``lюА!Ге*Ы^#VХ#^#VблеЇw# Н’ Н’ Н’ Н’Н™ю:беВТНsКЦAЪюТ<w#НsК ю.Крю;К!Н?ВЬГбе	 	 ю;К!     LD   (REG1),A
        LD   A,(HL)
        LD   (DE),A
        INC  DE
        DJNZ rd
        XOR  A
        RET

wt:
        LD   A,(DE)     ; write data
        LD   C,A
        LD   A,B
        LD   (REG1),A
        LD   (HL),C
      т*є}ґКS~#·В!  "є"јАГSzіВ-*Ш"Ы##"є>2Я:·2*ЫN#еЇG2№ВHЕеНбБюКWю
КWюВ|:К<К€:W:·єКH2x·КyГдюВ“:Л<Кex·КH~+Г8юВЁЕx2еНиЇ2ГJюВёеЕЇНБбГHюВПб:!·ѕТ-5НГГѕюВЫНРбГ-юВ#Ї2ЕНРБбеЕx·К#NСХzђWЕе:єЬ з                                                                                                                                                                                                                                                              ),A
        CP   (HL)
        JR   Z,mdini1
        LD   A,1        ; RNF (Record Not Found)
        RET
mdini1:
        INC  C
        JR   NZ,mdini
        DEC  B
        JP   P,mdini
        LD   A,D
        LD   (@mdfrm),A

mdsrt:
       oЙ  ЗЗЗЗЗЗЗЗЗЗ  :ЯO*ЫлГ7 *ШЂ Г/*Ш"Й*"ШГ[Б<И:жђgЙе:Яю!ФеН,С*щл}DЙ!~6 ·АГ	я!ЛеНSНЊЪrхOН сЙНЁАюВЃНаГbюКbюКbЙюИю
Ию	ИюИю Й:·ВНяжЙG:ПжxЙНЁВ›:·ВТНЁА:юКТНяжИН	яюВы!ѕВа6 Н	яюВс:ПжКВЇЦИ<НГа!G:ееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееее  INC  DE
        DJNZ wt
        XOR  A
dummy:
        RET

        end
t:
        LD   A,(DE)     ; write data
        LD   C,A
        LD   A,B
        LD   (REG1),A
        LD   (HL),C
      юoКНяГН б#БГч    CP/M Error On  : $Disk I/O$Invalid Drive$Read/Only File$Read/Only Disk$File Exists$? in Filename$  ГЌГЌ>я2Лa.я"z:М2н:з<Ды:ЯюК^юК^Гd{•_zњWРЙ{…_zЊWРЙИ)ЏГГНх	4А#4А#4ЙНЮлГхНх	РЙНЮГЩѕА#ИГлИw#ГцJ‡‡·ЂGх~жoс> ЌЙ_y–W#xћ#хІWс{ћЙs+p+qЙНх	еr#r#rН‹КSНю
 НабеНФ"Н™> 2zГ4бЙл  На!! q#p#wЙ2МwW*€НЫ
_ХНябТ†-Й!Жs:Ж!ЛѕВЌюяАНfИНђ*–~жх†wсД¦НГ
ЙЇ2ЧГГЂ*Ы л#~ 2Ч~ЎwН!  "ЯЇ2б=2Э*Ы~2гж=2ГюяКж2ЖНЂ:а*ЫwНіМНьГ6НКИ~Ц$М+лНю
БЙіцЙ*ЫН!А>	Г#>?–жИВ#·Й*Ы~ 	wЙНН0"гН*гНyНђВ}Н0Н‹ИНж
НЯН¶ Н™В^ГНЦ	2ХН‹И НшНх:Хж@К•еН
~б#wН>Н™КГ{Н†ИН _е++VХНю
л*Ы НхН-OСбs++r л! ‘КЩxТЧ>Ђ¶wЙ~·А6 :Д·И6ЂЙ~#¶+Аw#w+Йе ~юЃЪж Й*Ы ЙН
л! ЙН
~2Кл~·В+
Н-OНД~юЃЪ2
>Ђ2ЗНэ	:©¦2ИЙН
:Кw:ЯюТP
4л~юЂР:ЗwЙНэ	r##rЙp#ИГb
И|·g}oГj
*Њ  Ї†#В
ЁGВ|
ЙНп	*–ѕДЎ
:Ч·И*ЫЇwЙ*Ыл*юН=Тµ
*’НЫ
Ибб>
ГЛИ)ГЅ
€:ЛO! Нј
µґЙ*†:ЛOНi
}жЙНю
Нр
РГЃ	 ~ЙНШ
ИГ|*Њ  ·КOНЉ	DMН }ґВ>ГЛ"Н"»Ї2№:М2єл*Ы 	:Е·:ДКEНsГMO 		s#rЕН°	:Яю(В±y==В±Бх*Не!µ^WХ*ћ=2№wНXСХЇw#т|WВ|*У"НЕННКБНj*НСХ:ЁҐ ВЊбб"ННRС:КWХНЪвКИ>НГвНRНКНБЕ:Н!Ё¦КЯ НjБx!ЗѕЪпw4ВчНљНЎМљГ@
НNН4ГО ~*”wГ:ВГЛЕх:©/Gy Oс ‘жБЙН
AЕБЇ+ѕВBВ8y2Д:Е·xВOЕеo& :§W>’OНi
E:©ёбЪ5Нэ	N/жЎ°БЙ*Ы"гy2еН>я2ВЙГЌНsНќНіМLЇ2вНЩВ  Н¤Н”К *глюеКАХН'СТ Ню
:еO ~юеМSy·Кю?КxюКюКфюМ–жВ-ГЕNНG:в<КНя|µИ^#V#"Ћ##"ђ##"’###"”#"–##л"ї!Нх*л!ҐНх*Є|!Е6я·КJ6 7ЙНяЇ*ђw#w*’w#w#wЙ>2ЦН'яГqЇ2ЦН*я·ИOН‚yюЪЌГЌ<А*€НЫ
ИНpб:Яю0И!М:ЖѕВ®НС:Ц·АГЌЇ2ЮЙ*бНi
"¶ л!Нs#r#pЙ*ђN#FЕ*’^#V#F*Н:ПO}“|љyеТч*ҐН°бг+гГа*ҐН№б}“r#~хеж?w#>r#В=JМ§·
КН4   НббсwН¶ Г Нэ	~OНК™еЕНБб:z<И>Ўw##~2ЙВ_4~ж?К€НКН†Вx:Б<К€НЭК€Г{НҐНяН
Ї2КГЛН	:Йw++~=жwГП4Н-OѕТ«5:Б<КП4НфНДГ{НЉ>я2БН
:К!ЗѕЪШюЂВПН3:z·ВПНћ	КПН°	НЪ@
ВцНRНКН_Г@
!  "»>НwбЙЇ2zНШ
АН	жЂАН„К№Н-OFЕqНфyёЬДН3Нэ	БNpГДН†И НЇ:Е·КZ~·ВMw·ВS~ѕВ№ГoНжлНжлѕВ№#ѕВ№#В?лмя	еН-СНїwЕ 	л	БК КЎѕЪ ·ВЎНЬлwНю
 ~жwН Н2Г>НyГ&ѕАлѕлАЙ!яя"ЯЙ*Я>ьҐo+"бЙ!ЯН—ДС*Ые!…"ЫНsН™б"ЫИ :Ш…oР$Й*Ы ~ЙН	6 ЙНэ	~жwЙН	цЂwЙ*бл*Ћ{–#zћЙН'Шr+sЙ{•ozњgЙю*¶л*°|жgН=РЕНv
*љл*¶БК„КЏѕИНШ
АН>я2Ю2њН¦НГ
ГфѕwИ*–>¶wЙwЙ:Ж†НЙ
*¬#л*Ћs#rЙ*ђНЫ
И’ГЖ
:±жЂА!д:ЯG~ёИ#·ВА<Й*–#~·Й!dе!сНјК·
!шНјК&бЙ!Ю~·И6 НЂ!  "бЇ2ШЙ*Е*Ыл!! ~жх~#~жO~жр#¶G~жьб.|ВЙ!  w:ЯюcК‡ХН„СКw! x–ж?Вw! ~№КЅНВwЕН-Б№ТlСХВlСГПqOНфНДГЅЕХНСБ.:z<КЙНК! еVq##~_Хж@°wНЎ:z<ВёСбБЕеХ.КВНЭ.КВББНяБЇГЛСгr##sбБ}ГЛяН МґЙ Н М­ЙлN ! ~жЂЃO> €G~жЂG! ~‡‡DЇ2бxБ·В™#ГПЇ2В2zGЙж?ЙНSНќ>яGГЛx·В™~·В™:б·К™2вГ°Б™ЕА##~·АН[е*Я$Вa*б"ЯбЙНЦ	ШН‹ИК„Нж
*ЫН!К~ГЉН™ГlН‹КНю
6еН> Н-Н¶ Н™Г‡PY*Є{•zњТЦЕХBKНкТОСБy°КўХЕНкТОБСГў<НбСЙy°Вє!  ЙЂНшК>~ ЕGж°wБ#ГеХ *Ы	#|љyЪ	г#геГчге*ҐН°бХЕел*ІDM"юНяС*ђs#rБС*’s#r#pБy“oxљgН[	DM*їлН0яMD" Н!я*ЉMDГ$я:ґOГi
!§N:К·Вi	G>–O:ИКЂ	·Гw	ЂЙ*Ы ЙН‚		:Е·К	n`Й	~#foЙНb	2ДO НЉ	"Н}ґЙ:§O*НЇНВ"Н2П"У:ЁO:КЎG2ё!Н¶wЙ*Ы ~‡хzWсw+ВЯ	zЙНэ	#~Й*Ы! Й*ЫГ@
:ёG:µO х:ЅюЪ=2Ѕс7АЇЙсК)y·ИцЙy/W!К:ѕюЪ#†юЂЪ?>ЂЕF6Еех:Ё_/ Gб:Б·К^:ЗўјЪ_|ђO»ЪfKyбБpБ!ѕVђєТuWy/ў2ЅК&х:Б·КЊНєНRсgН[	|юOДEяЇЙН	жwЙН	ж@х~ц@wсЙ> 2БНч
:Ч·>В*ЫНй
НЉНиН
:КюЂЪЭН3:z·АНћ	Кы!МєНлКц>я2№ ГOНb	2ДВюЙХНкжюБ±ВwЙ:уШхН†DM*њT]	сКKялГKяЕНNБ:уж@АЕН†л*њБе"њНNб"њЙНю
 ЕСИХ:Е·КkЕеN ГqЕN#Fеy°КЂ*Є}‘|Фб#БГX*ЄНi
#ЙНК6 ННН†DM*њ6 #x±ВЈ*”w*®л*њs#rНL*Ћ6#6 Нќ*ў"УяН¤Н”КНю
л*У|Ґ<лД >!ѕКО>еѕКО> ѕК
>¦В–NНп	qЙ* Г* Г*ћ}¤<ИеМНлбА6яЙХ
 ^#VлСЙНі>ГFНч
НD>!  "»*ћН*ШГ[Н+"ЉЙ*Њл*ЉЂ НKя!z~<И:бжwЙН ##>яw#wЙН‚	Г—Н„Аб>	ГЛ!б~#ѕА<Й!яя"бЙНЄГЬ*¬л*б#"бН=Ъќ:бж‡ВВ2Ш·АЕН6Б:Ю·АГFНМ:Ю·ИНСНйГ6yж<_W`iНi
DM*њ	~6 Н*беНLНќ НЄ!Ю~·К+6 б:Яю0ИНсГСН'Ъб"бЙ!р~·И6 *€>=)ТXхе!ЛНfН_Дьбс·ВCГЂ* }¤<И ~·Й*”~жЙ Г{Н§·А>ХфеХ НNяНлСбВхбЙНю
	ОХГ„:бжюИG*Њ` ~Ц!Аx‡_‡‡ѓ<Ѓ_ЇЙНХА*”y¦ВШ
<Й:©ца/GНэ	~ А##~ж?Й НЛАН	ж@АНэ	F6 е##N6 еееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееел*беН=СµИеле+))	 ќ®жВP Нћ Кg лб#г+}ґгелВ ббН”АНіА>я2њ*Ћ^#Vл+НФЇЙ:а<Кђ <В' Нћ В' ~жВ' *блб+"бБ}жюИ{жь_}жьoН=µИНМ:њ<МќЇЙ~юхВ' лб"ЯГ) :њ·ИOцђG® Ае#НлбЙНТИ!Щќ еХЕНKя*ўеНю
НN*б))СБСХЕНKяБбСГKя BI"B" ‘$ђ„$ Ђ@"      _*†л"€}Јo|ўg"†>я2ЛЙ{·К&юЃТ&2жЙ{2зЙН|*њлН†  ·КDТ<Г8+}ґВ7*Є#}‘o|g:§OЇНВл*Љs#r#wЙ!і~цЂwВИ~ц@wГИН6НHяНq*€>=)ТЇхе_Н|:Яю0К НГЄНє:Г<В­Нбс·В‡ЙНHяНq:µ·И>Гл~юcРл!њ…oл#~ююТЯл^#VлГГG#~И#~Й!еле##N#F#^#V#~#foг~	! ’@ђ"$I!$’I$’H‘	„H$’I"I$’I$BHD’I  „ђ‰$Ђ@@’HHI$H"H     ђ’	$I$’ђ’I$ Ђ B ! ’I""	 BDBA€$Ђ„@               ђ„’B‘B"$€B@DЃђЂЃ!	!                   @          ‚@!„!DD@ЂЂ @  Ђ @I!  @’ €$"$‚A  BD$Ђ ‰                                                                                                                                                          ЇЙ     1                                                 $  њЂ               яяя        яяяяя  Г{  ЕН†ДyЇ2zБбp##qЙ:ЎГЛ!яяНфЇ2Ъ!Ђ "ШГRН|:Ж2ЪЙННҐН:а·КN>ю2а<2бНЎН|!бѕИw:аююИНС>Ђ2Ч*Ы6 НsН™Н¤Н|ЙН”ИН
~<ВЊwб:ЧТ§*Ы
 ~жЂВ§2ЧГ&Ня@НЗМtђГЖ
Н¬НяН–
Н:z<ИГґлЇх~ю?ВаНЂНр ГфНэ	~ю?КпНННҐсхК*бе>ьҐ IH$   B!$$H‚!€ ђH"$’! Ђ A €$A	"$B ЂЂ"D„$ђ$Ѓ $@‘ Dђ  D  €‘B!$ђ@H@‘$$’DD!$Ђ$  „ђI$DH "H‰$A’@! „@€€€Ђ  Ѓ„!$ "	$$‘ ‚@DђЂ D„! ‰!$‰!$Ѓ$A ђDD"@$BDђЂ"$„"I$’HBI„  Ђ! Ђ 	$$’D	$’@IЃ$‘ €H     UUUUUUUUUUUUUUUUUA Hђ„ЂBI $"   Ђ@„!  @HIA D‘"BB  "$	"H BD‰!$„  H$‰ђBD!!$D	 ‘ D €„  $"BHD!	$	HHA€II "„‰!‘!‰!‘! ЂB"D‘ Ђђ!B"I$$’A"D$!!$H€ 	$             „$‘!	   H‘  B‚BD$A ЂD‚BAH’D$еo‡…! я…oг#~бгЙл*ЛщлЙНҐНяН В&Ню
 НаНх	НЪ&ІК&Нж
Н>НиН‹КН№Ъdх Н-сКjНю
6еН¶ Н>Н™ГFН
Нb	НУН-ѕwхН
~<слДЬ:Д·МЬ НЇл~жw#w#6 ##НхН-ГaНю
	л*Ы	Й НЇ~ж?GёА++NНИѕЙ<!Е4КЬ‡5Н‚	O 	>№Иp#ГжН|НmГЛНҐННZ
‘$ ‚       ђ„’B‘B"$€B@DЃђЂЃ!	!                   @          ‚@!„!DD@ЂЂ @  Ђ @I!  @’ €$"$‚A  BD$Ђ ‰ еХНNбќ НKя"УбЙ·ИюЪJ>К">2њлНТИл:ЯюКNю#К=юТN>2њеН!бВNЇ2њ~2ќ#л!  ж ВЊЕКtКt)ЏхxЪuс)ЏхжЦ ТO с	О БВ_"ћ!ќж¶wж ВЙжOж?WжGzжа±O:©ТДхxGyOсГµxж¶w qЙ*ў}ґ<ЙНТИ:њ<И:е·И*Ћ^#Vл=Вх*¬"Э*ўDM*Эo"бН6б"бс!_еКЌ:еOНsГ™*г"ЫцГОНҐГcН¬НЊ
ГґН¬НЊ
Г­НННҐННКНЎН”·К`Н-ѕТ}хсФЭН”ИНяPН¬ НЗАНyГЎ>O2{Н&Г“НҐГ:*€ГГ:ЖГЛл"ШГRНЂ*њГГ*†ГГННҐНqГНЂ*"zЙ:ГюяВХ:аГЛж2аЙН¬НЊ
ГОН¬НЊ
ГЧН¬Г(л}/_|/*€¤W}Ј Ђ  "	 BH$D‚H‚@‰ „’ $‰	  ‚@A$Ђ	I"I$‰$ €DD’H„‘$’I$’ „@ B ЂD„$DђЃ I’I	!$„„$ЃBD‘$€ $ „@€ЂBB$H „€I	$„€B I    Ђ„D ЂI‚’"@ 	!@$          A	!  „„B$A ђђ@ €‘$’$’	A$€ЂЃ	$@ „" B"@   D! ‚  	A$‘$€D’! I"! ’BI$’  * хНК:Н_ 2ы{Ў2Н"ьН+"ЉНС~<КjсхюТ5НлК–ЇНЪюКB~·Кj6 *Не:ПхНСлНх!Л:МѕДi>МвБСНБНЂсюРхюВ~!№:ёѕТ€*ь6я>Г‹<wЇНвНСНх6 :ы<Ђ !Ђя=В л*ЉсюВґ"ЊЙл*ШЂ юКKялНKяНЪ6яЙ:µG/OЙ*ьМЙ *ьЙхНКс=Кjф_НЪ##юГх   Н†ИН‚	 Нb
е Н§·ВСлГхб Гb
!фНB6 яГNя НNя!флНBГЛГх!  лГхzЈ<*¬КГл"¬Й!яя"z:Э·К{*Ы:гw :Ч¶w*Лщ*z}DЙе                                                                     яя                       #cdfg !"()        Љ                                                                                                                                                                                                                                                             ,?auxi
        public ?home,?sldsk,?sttrk,?stsec,?stdma,?read,?write
        public ?lists,?sctrn
        public ?conos,?auxis,?auxos,?dvtbl,?devin,?drtbl
        public ?mltio,?flush,?mov,?tim,?bnksl,?stbnk,?xmov


    ; BIOS Jump vector.

      00H      ; Console Command Processor gets loaded into the TPA


    ; variable in system data page

        extrn @covec,@civec,@aovec,@aivec,@lovec ; I/O redirection vectors
        extrn @mxtpa                            ; addr of system entry poin7!  °0лЂ2‹ан°2ѓаЙy2куXюнC>рХ0Н!СЙ
BIOS Error On A: No CCP.COM file CCP     COM                        лн°лЙ*"ю*&юЇЛ|Д·АЛlИ'*$ю*(ю**ю>яЛ$!Ь·ИЛ$Ь·ИЛ$РН!:HрџЙ*"ю*&юЛ|Д·Д!:{цАЛlД·Д!:zцА|ж  Ч>Й*$ю*(ю**lock support

        extrn ?time                     ; signal time operation

    ; general utility routines

        public ?pmsg,?pdec      ; print message, print number from 0 to 65535
        public ?pderr           ; print BIOS disk error messееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееГc Г€ ГvГАГфГюГщГЕГ@Г ГCГHГMГ\ГaГљГRГђГ{Г•ГК Г(ГО ГѓГ€ГqГГН ГН ГuГ  Г  Г  !  "&ю"(ю)"*ю)""ю"$ю1К Н” !ЉНТ НЧ	1К Н” Н Г >Г2  2 ! " *bю" Н! Н!	Г!                !)Й!BЙ~·ИOеН б#ф!±НТ :ауЖAOН !ГНТ *вуН!ИНТ *auxout
        extrn ?cinit                    ; (re)initialize device in <C>
        extrn @ctbl                     ; physical character device table

    ; disk communication data items

        extrn @dtbl                     ; table of pointers t

    ; initialization

        extrn ?ldccp,?rlccp             ; load & reload CCP for BOOT & WBOOT

    ; user defined character I/O routines

        extrn const,conin,conost,conout
        extrn listst,list
        extrn auxist,auxin,auxost,юyЛ|2{ц$Д!Лt2yцД!ЛlИ2zцнSРу2 дЙCRT    CENT   V.24   lЏ                    І      
YY`\н          Люяюяюяюяюя 
YYa\н          Люяюяюяюяюя  эYYP             Ь  юяюяюяюя     / А   Ђ   ? А  Ђ   	
Їage header

        extrn ?jsr65            ; select 6502 processor

        include DEVICE65.LIB    ; define 6502 device driver entry points


    ; External names for BIOS entry points

        public ?boot,?wboot,?const,?conin,?cono,?list,?auxo        title 'Root module of relocatable BIOS for CP/M 3.0'

        ; Rev. 06/09/89
        ; by Werner K.G. Muenchheimer, 5469 Windhagen


        .Z80
        cseg
        org 0

cr      equ 13
lf      equ 10
bell    equ 7

ccp     equ 01дуе|Н	б}хНсжц0ю:8ЖOГ y2ау !B		~#foґИЛШл!ъяN#FЕbkЙ  нCвуЙнCдуЙнCжуЙi`zіИn& Йъяшя*ау& )B^#Vkb+~2йу+~2бу	~#foйy2иуЙЇЙ

CP/M Version 3.0, 56K BIOS R6/89

 
BIOS Error On  : T- H, S- !*НТ Н	 Ї2mMН <(и Н Ђ,Н MН Їto XDPHs

        include DSKIOB65.LIB            ; define disk IOB data structure

    ; memory control

        extrn ?xmove,?move              ; select move bank, and block move
        extrn ?bank                     ; select CPU bank

    ; c           ЃH$ђЂ        /Abort ?  $’I$’I$’I$’@ ‘I$$Ђ@ Ђ@ђ	 ’ Ђ Ђ                   ’$                „ ! @! A Ђ       D @ЁЂ U>'Ї>*2ку·ДZН!:ку·МZ:лу·И:Kю<()ХНЮ !kНТ *куН!qНТ Н	 хOН сСж_юR(ЕЦIИ:лужЙХ*жу я л н°СЙH, F- H, Retry/Ignore/Abort ?  $’I$’I$’I$’@ ‘I$$Ђ@ Ђ@ђ	 ’ Ђ Ђ                   ’$                „ ! @! A Ђ       D @ЁЂ U          ; All BIOS routines are invoked by calling these
                ;        entry points

?boot:  JP boot          ; initial entry on cold start
?wboot: JP wboot         ; reentry on program exit, warm start

?const: JP const         ; return     RET


;       Utility Subroutines

?pmsg:                   ; print message @<HL> up to a null
        LD   A,(HL)
        OR   A
        RET  Z
        LD   C,A
        PUSH HL
        CALL ?cono
        POP  HL
        INC  HL
           LD   (@lovec),HL ; set listout to CENT
        ADD  HL,HL
        LD   (@civec),HL ; set conin  to CRT
        LD   (@covec),HL ; set conout to CRT

        LD   SP,boot$stack
        CALL init        ; initialize page zero & character devices
      ; set disk sector
?stdma: JP setdma        ; set disk I/O memory address
?read:  JP read          ; read physical block(s)
?write: JP write         ; write physical block(s)

?lists: JP listst        ; return list device status
?sctrn: JP sectrn   DE,?ilst    ; (re)initialize device #1 (CENT)
        CALL ?jsr65
        LD   DE,?iv24    ; (re)initialize device #2 (V.24)
        JP   ?jsr65


           ds 16
boot$stack equ $


        ; DEVTBL
        ;       Return address of character disk I/O DMA operations.
?xmov:  JP ?xmove        ; set source and destination banks for one operation

        JP 0             ; reserved for future expansion
        JP 0             ; reserved for future expansion
        JP 0             ; reser console input status
?conin: JP conin         ; return console input character
?cono:  JP conout        ; send console output character
?list:  JP list          ; send list output character
?auxo:  JP auxout        ; send auxilliary output character
    CALL init        ; initialize page zero & character devices
        CALL ?rlccp      ; reload CCP
wboot1:
        JP   ccp         ; and exit to ccp


init:
        LD   A,0C3H      ; set up jumps in page zero
        LD   (0000H),A
        LD      LD   HL,sigmsg
        CALL ?pmsg       ; and print signon message
        CALL ?ldccp      ; fetch CCP for first time
        JR   wboot1


        ; WBOOT
        ;       Entry for system restarts.

wboot:
        LD   SP,boot$stack
           ; translate logical to physical sector

?conos: JP conost        ; return console output status
?auxis: JP auxist        ; return aux input status
?auxos: JP auxost        ; return aux output status
?dvtbl: JP devtbl        ; return address of  device table

devtbl:
        LD   HL,@ctbl
bnksel:                  ; not implemented
setbnk:                  ; not implemented
        RET


        ; GETDRV
        ;       Return address of drive table

getdrv:
        LD   HL,@dtbl
   ved for future expansion


        ; BOOT
        ;        Initial entry point for system startup.

boot:
        LD   HL,02000H
        LD   (@aivec),HL ; set auxin  to V.24
        LD   (@aovec),HL ; set auxout to V.24
        ADD  HL,HL
     ?auxi:  JP auxin         ; return auxilliary input character

?home:  JP home          ; set disks to logical home
?sldsk: JP seldsk        ; select disk drive, return disk parameter info
?sttrk: JP settrk        ; set disk track
?stsec: JP setsec       (0005H),A
        LD   HL,?wboot   ; BIOS warm start entry
        LD   (0001H),HL
        LD   HL,(@mxtpa) ; BDOS system call entry
        LD   (0006H),HL
        LD   DE,?icrt    ; (re)initialize device #0 (CRT)
        CALL ?jsr65
        LD sk caching

?mov:   JP ?move         ; block move memory to memory
?tim:   JP ?time         ; Signal Time and Date operation
?bnksl: JP bnksel        ; select bank for code execution and default DMA
?stbnk: JP setbnk        ; select different bank fordevice def table
?devin: JP ?cinit        ; change baud rate of device

?drtbl: JP getdrv        ; return address of disk drive table
?mltio: JP multio        ; set multiple record count for disk I/O
?flush: JP flush         ; flush BIOS maintained diJR   ?pmsg

?pderr:
        LD   HL,drvmsg   ; error header
        CALL ?pmsg
        LD   A,(@adrv)   ; drive code
        ADD  A,'A'
        LD   C,A
        CALL ?cono
        LD   HL,trkmsg   ; track header
        CALL ?pmsg
        LD   H

write:
        LD   BC,-8


rw:
        LD   HL,(@adrv)  ; get drive code and double it
        LD   H,0
        ADD  HL,HL
        LD   DE,@dtbl    ; make address of table entry
        ADD  HL,DE
        LD   E,(HL)      ; fetch table entrydress from <BC>
        ;               in @TRK for further operations.

settrk:
        LD   (@trk),BC
        RET


        ; SETSEC
        ;       Set Sector.  Saves sector number from <BC>
        ;               in @sect for further operatiP  AF
prhex:
        AND  15         ; then print low nibble
        OR   '0'
        CP   ':'
        JR   C,cout
        ADD  A,7
cout:
        LD   C,A         ; print character 0-9/A-F
        JP   ?cono


        ; DISK I/O interface routi
        ; READ
        ;       Read physical record from currently selected drive.
        ;               Finds address of proper read routine from
        ;               extended disk parameter header (XDPH).

read:
        LD   BC,-6
        Jput pointer in <DE>
        LD   HL,-6       ; find LOGIN addr
        ADD  HL,DE
        LD   C,(HL)      ; get address of LOGIN routine
        INC  HL
        LD   B,(HL)
        PUSH BC
        LD   H,D         ; recover DPH pointer
        LD L,(@trk)   ; track number
        CALL ?pdec
        LD   HL,secmsg   ; sector header
        CALL ?pmsg
        LD   HL,(@sect)  ; sector number

?pdec:                   ; print binary number 0-65535 from <HL>
        PUSH HL
        LD   A,H
      ;       Sector Translate.  Indexes skew table in <DE>
        ;               with sector in <BC>. Returns physical sector
        ;               in <HL>. If no skew table (<DE>=0) then
        ;               returns physical=logical

sectrn:
 ons.

setsec:
        LD   (@sect),BC
        RET


        ; SETDMA
        ;       Set Disk Memory Address.  Saves DMA address
        ;               from <BC> in @DMA.

setdma:
        LD   (@dma),BC
        RET


        ; SECTRN
    nes


        ; SELDSK
        ;       Select Disk Drive.  Drive code in <C>.
        ;               Invoke login procedure for drive
        ;               if this is first select.  Return
        ;               address of disk parameter headerR   rw          ; use common code


        ; WRITE
        ;       Write physical sector from currently selected drive.
        ;               Finds address of proper write routine from
        ;               extended disk parameter header (XDPH).  L,E
        RET              ; return via LOGIN


        ; HOME
        ;       Home selected drive.  Treated as SETTRK(0).

home:
        LD   BC,0       ; same as set track zero


        ; SETTRK
        ;       Set Track.  Saves Track ad      CALL prbyte      ; print high byte first
        POP  HL
        LD   A,L         ; then print low byte
prbyte:
        PUSH AF
        RRCA
        RRCA
        RRCA
        RRCA
        CALL prhex      ; print high nibble first
        PO       LD   L,C
        LD   H,B
        LD   A,D
        OR   E
        RET  Z           ; IF @<DE> equal zero, no translation
        ADD  HL,DE
        LD   L,(HL)      ; get corresponding sector from table (XLT)
        LD   H,0
        RET

     ; point at disk descriptor
        INC  HL
        LD   H,(HL)
        LD   L,A
        OR   H           ; if no entry in table, no disk
        RET  Z

        RRC  E           ; examine login bit
        RET  C

        EX   DE,HL       ; 
        ;               in <HL>

seldsk:
        LD   A,C         ; save drive select code
        LD   (@adrv),A
        LD   B,0
        LD   HL,@dtbl    ; get pointer to dispatch table
        ADD  HL,BC
        ADD  HL,BC
        LD   A,(HL) 
        INC  HL
        LD   D,(HL)      ; @<DE> points to DPH
        LD   L,E
        LD   H,D         ; get index to pointer
        DEC  HL
        LD   A,(HL)      ; get density
        LD   (@type),A
        DEC  HL
        LD   A,(HL)     ееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееее0 †  0А   Г  u ‡H Xu‡R Xu4‡W Xu„†  0кђ  aЂ 0 ‡rЂ` з 0мД °А   Г№ ;љ Г  `   aЂ  ЂD  Ђ H€  €Ђ   1№@Ы( !±@,Ы¤ Н   ‘ЌК fЩ@h  Г  GМ1ђ  2Ђ4 D 
Ђ     D fЪА €$Г¶@Ь   ЙЂ “тЭђOrіh`„Fzm€6й њ61ћНЎЂ†Нє@§Н›.

flush:
        XOR  A                  ; return with no error
        RET



        ; signon message
sigmsg:         db      cr,lf,lf,'CP/M Version 3.0, 56K BIOS R6/89',cr,lf,lf,0

        ; error message components
drvmsg:         db      MR2\“TХХ'   ћMQ	9.:HЏФХPc¤ эMQM:<ЏФХ’г©АэQ%62ћOХSQc `э]	==R:TЏХФ’UcЄаэa5=Z2°ЏЦSХ‘c,а%Y2ФђSХ‘Pг.@%Y2кђУХ‘Pг9`Q	22ЦP“#-А1=Y3FђVc"АUa%:2nђUVTХ#'@Ua=MR2&ђUVХU#!@=9%:2hђУУ“ФХ#! =9=UR2PУУ”Х#" 1%ееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееее ; get unit
        LD   (@rdrv),A
        ADD  HL,BC       ; make address of read/write entry
        LD   A,(HL)
        INC  HL
        LD   H,(HL)
        LD   L,A         ; get address of routine
ipchl:  JP   (HL)        ; and leap to driver
Ua%N:$OРUVг§ эUa=N0 OРђS’гЄ э	9-M2: OР“УХ#( э%9%R:ЏРУУ’SЈЎЂэ=9>:fЏРУУ“Фг Аэ=9MR:~ЏСU’SЈЁ@эIQ	2:xЏС•“#© э1UM":0OТУQc7 э)MHШЦ3ЏУРФ#Ўаэ1%MR:ZЏУTХгЁ э51Q%>:–УSХЈ)Ђэ5=Y:OФPг»АэAIJ;¤OФTСг¤аэI3ЏФ“РФ#¦ эM@ЂD7 ›tЂNG›”шНЎ .лФѓЩґHвжЅ†бРаЖ“Шt0 т2p<ААП ‚OВ31ЅhИe‚Ы±йю'ИМS­’  ¤7Н’н!№l—iМуdљLҐ› 2n  Уь0 ѕв§МL „i8dј#+МBірЙТуџ†N$ь#3Э'‘“ЎжЙWІA  Q /&€
ЖS‘МТo7bбЂ°@5Д"I<¦ )…гЃИ4
 A@r$ћSNG#yИ@O7 ЎPZ $1h:*OРUVc¦Аэcr,lf,bell,'BIOS Error On ',0
trkmsg:         db      ': T-',0
secmsg:         db      'H, S-',0


        end
  db      cr,lf,lf,'CP/M Version 3.0, 56K BIOS R6/89',cr,lf,lf,0

        ; error message components
drvmsg:         db      ееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееее…‰С\]X] SхХ4xэA?PDERRЃOР“УХ cхt$фхHэ=9MR?CONINЃOРУУ“аSфД•5HэUa>?AUXIЃOТУQ`cх4ДE4ёэMQQI.?STSECЃЏФХP`Sх$THэ]I%Q?LISTSЃЏФРХ“ cф4фдх8эUa%N?AUXOSЃЏС•“ cфDUd”иэIQ	2?MLTIOЃЏС“TТ CфФхhэQ%6?BNKSLЃЏФХ“’аSх„Фхi@ Ч8Z -  aЦ0€ aЂ 

        ; MULTIO
        ;       Set multiple sector count. Saves passed count in
        ;               @CNT

multio: LD   A,C
        LD   (@cnt),A
        RET


        ; FLUSH
        ;       BIOS deblocking buffer flush.  Not implementedQI::6ЏФУТгЄЂэMQ	9.:HЏФХPc¤ эMQM:<ЏФХ’г©АэQ%62ћOХSQc `э]	==R:TЏХФ’UcЄаэa5=Z2°ЏЦSХ‘c,а%Y2ФђSХ‘Pг.@%Y2кђУХ‘Pг9`Q	22ЦP“#-А1=Y3FђVc"АUa%:2nђUVTХ#'@Ua=MR2&ђUVХU#!@=9%:2hђУУ“ФХ#! =9=UR2PУУ”Х#" 1%ееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееее        title 'Boot loader module for CP/M 3.0'

        ; Rev. 06/09/89
        ; by Werner K.G. Muenchheimer, 5469 Windhagen


        .Z80
        cseg
        org 0

        public ?ldccp,?rlccp,?time
        extrn ?pmsg,?conin
        extrееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееее    ' ; f1...f8
        db 'COM'      ; t1,t2,t3
        db 0          ; ex
        db 0          ; s1
        db 0          ; s2
        db 0          ; rc
        ds 16         ; d0...dn
fcb$nr: db 0          ; cr
        db 0,0,0      ; r0,r1,r2           ; here if we couldn't find the file
        LD   HL,ccpmsg   ; report this...
        CALL ?pmsg
        CALL ?conin      ; get a response
                         ; and try again

?ldccp:
        ; First time, load the A:CCP.COM file intЋ¤ SхD”ФXКh@DATEњ   ћ?TIME”  MhА%  Р \ fЂ Р ^2іаю і@ аЎР  AБ¦h @…ЊР( #_АБFh Ї Fв " X .°
 2Eё«’АЙ<ЊќO0  н!ЏћP€АН  ,ђh(„I'”ДS‘ИЮrНВи@N7€d2Ђё†O&€Ж“a” !ђК Ђ@ !“Й    -џ     И8?CONINЊ¬ cфҐ5#cXиH?LDCCPЊ‚ SхХ4xйђ?RLCCPld$rl1:
        LD   BC,0C80H    ; clone 3K
        LD   (0E08BH),A  ; select extra bank
        LDIR             ; move block
        LD   (0E083H),A  ; select TPA
        RET


        ; signal Time and Date operation
?time:  LD   A,C
        Ln ?jsr65
        extrn @date

@a2l    equ 0F03EH       ; SCB date & time vector

        include DEVICE65.LIB
        include DSKIOB65.LIB

bdos    equ 5            ; BDOS system entry point
open    equ 15           ; Open File
rdseq   equ 20    ееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееее

        end
 ; s2
        db 0          ; rc
        ds 16         ; d0...dn
fcb$nr: db 0          ; cr
        db 0,0,0      ; r0,r1,r2o TPA
        XOR  A
        LD   (fcb$nr),A  ; start at beginning of file
        LD   DE,ccpfcb
        LD   C,open      ; open file containing CCP
        CALL bdos
        INC  A           ; error if no file...
        JR   Z,noccp
        LD  ееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееD   (@cmd),A
        LD   BC,@date
        LD   (@a2l),BC
        PUSH DE
        LD   DE,?clock
        CALL ?jsr65
        POP  DE
        RET

ccpmsg: db 13,10,'BIOS Error On A: No CCP.COM file',0

ccpfcb: db 1          ; dr
        db 'CCP        ; Read Sequential
setdma  equ 26           ; Set DMA Address
setmlt  equ 44           ; Set Multi-Sector Count

    ;   This version of the boot loader loads the CCP from a file
    ;   called CCP.COM on the system drive (A:).

noccp:        …‰С\]X] cфДD45эI1B?TIME”  MhА%  Р \ fЂ Р ^2іаю і@ аЎР  AБ¦h @…ЊР( #_АБFh Ї Fв " X .°
 2Eё«’АЙ<ЊќO0  н!ЏћP€АН  ,ђh(„I'”ДS‘ИЮrНВи@N7€d2Ђё†O&€Ж“a” !ђК Ђ@ !“Й    -џ     И8?CONINЊ¬ cфҐ5#cXиH?LDCCPЊ‚ SхХ4xйђ?RLCCPOR  A           ; now,
        JR   ld$rl       ;   copy CCP to LC bank 1 for reloading


?rlccp:
        SCF
ld$rl:
        LD   HL,0100H    ; start of TPA
        LD   DE,0B000H   ; start of LC bank 1
        JR   NC,ld$rl1
        EX   DE,HL
 DE,0100H    ; start of TPA
        LD   C,setdma
        CALL bdos
        LD   E,128       ; allow up to 16K bytes
        LD   C,setmlt
        CALL bdos
        LD   DE,ccpfcb   ; load the thing
        LD   C,rdseq
        CALL bdos
        X        title 'Character I/O for the Modular CP/M 3 BIOS'

        ; Rev. 02/23/89
        ; by Werner K.G. Muenchheimer, 5469 Windhagen


        .Z80
        cseg
        org 0

eof     equ 01AH         ; immediate end of file character

a$prata
        LD   A,(@pscl+3) ;     (slot #3)
        RET  NZ

        BIT  5,H         ; device #2 selected ?
        LD   DE,?isv24
        CALL NZ,ios      ; get V.24 input status
        LD   DE,?idv24
        CALL NZ,?jsr65   ; get V.24 input dcost


        ; LISTST
        ;       List Output Status.  Return true if
        ;               all selected list output devices
        ;               are ready.

listst:
        LD   HL,(@lovec) ; get list output bit vector


cost:
     DEVICE65.LIB    ; define 6502 subroutine entry points
        include MODEBAUD.LIB    ; define mode bits and baud equates


        ; CONST
        ;       Console Input Status.  Return true if
        ;               any selected console input deviady console input device.

conin:
        LD   HL,(@civec) ; get console input bit vector
        JR   ci


        ; AUXIN
        ;       Auxilliary Input.  Return character from first
        ;                ready auxiliary input device.

au; CONOST
        ;       Console Output Status.  Return true if
        ;               all selected console output devices
        ;               are ready.

conost:
        LD   HL,(@covec) ; get console output bit vector
        JR   cost


 eg  equ 0F048H       ; 6502 P (status) register pass area
a$vec   equ 0F3D0H       ; address of 6502 sub to call goes here
@pscl   equ 0F678H       ; pascal character write location

        extrn @covec,@civec,@aovec,@aivec,@lovec

        public ?cDE,?oslst
        CALL C,ios       ; get CENT output status
        RET  Z

        SLA  H           ; device #2 selected ?
        RET  NC
        LD   DE,?osv24
                         ; get V.24 output status

ios:
        CALL ?jsr65      ;     LD   A,0FFH      ; assume ready for no device

        SLA  H           ; device #0 selected ?
        LD   DE,?oscrt
        CALL C,ios       ; get CRT output status
        RET  Z

        SLA  H           ; device #1 selected ?
        LD   ce
        ;               has an available character.

const:
        LD   HL,(@civec) ; get console input bit vector
        JR   cist


        ; AUXIST
        ;       Auxilliary Input Status.  Return true if
        ;                any selexin:
        LD   HL,(@aivec) ; get aux input bit vector


ci:
        BIT  7,H         ; device #0 selected ?
        LD   DE,?iscrt
        CALL NZ,ios      ; get CRT input status
        LD   DE,?idcrt
        CALL NZ,?jsr65   ; get CRT input d       ; AUXOST
        ;       Auxilliary Output Status.  Return true if
        ;                all selected auxilliary output devices
        ;                are ready.

auxost:
        LD   HL,(@aovec) ; get aux output bit vector
        JR   init
        public const,conin,conost,conout
        public listst,list
        public auxist,auxin,auxost,auxout
        public @ctbl

        public ?jsr65

        include CONFIG.LIB      ; define hardware configuration equates
        includecall user status routine
        LD   A,(a$preg)  ; get status
        RRCA
        SBC  A,A         ; return FFH if ready, else 0
        RET


        ; CONIN
        ;       Console Input.  Return character from first
        ;               re selected ?
        LD   DE,?iscrt
        CALL NZ,ios      ; get CRT input status
        RET  NZ

        BIT  5,H         ; device #2 selected ?
        RET  Z
        LD   DE,?isv24
        JR   ios         ; get V.24 input status


        cted auxilliary input device
        ;                has an available character.

auxist:
        LD   HL,(@aivec) ; get aux input bit vector


cist:
        XOR  A           ; assume not ready for no device

        BIT  7,H         ; device #0ata
        LD   A,(@pscl+2) ;     (slot #2)
        RET  NZ

        LD   A,H         ; any valid device selected ?
        AND  0A0H
        JR   NZ,ci
        LD   A,eof       ; return a ctl-z
        RET


        ; CONOUT
        ;       Cle
CRT80   equ true      ; 80 column terminal card

; Boot default terminal & keyboard redefinition

SOROC   equ true      ; Soroc IQ 120/IQ 240
HAZEL   equ false     ; Hazeltine 1500/1510
DATAM   equ false     ; Datamedia
USRVID  equ false     ; U UH  1U% <ІПѓ#ЫШ"$1-X,и2<Ѕ‚ `CХЂ2НЊЃ‘йм
‚Ґ6ѓМd r2He" Ђ@ ЂdRqP@  
ВбђР@ ЃЂЫ ~†’њ’©« ЗйJjFЖ±• Ђ‚’¬Љ‡„ И)кИЁq”°Ђ†’¬Љ‡ ИiкИЁqЫ0
Ђ†Ё„™‰ И	‰кИЁqФр
‚Є°’ќ И*«	*j‘Ср‚Є°ћ¦©ѓ И*«	кЄ‘Ф 
†ћњ’ќ ИiйЙкj‘Ча†ћњћЄ©  ЁiйКj‘ШЂ’¦©$ Й‰*jЉj“Ђ  ћ Аo all selected devices.

list:
        LD   HL,(@lovec) ; fetch list output bit vector


co:
        LD   A,C

        BIT  7,H         ; device #0 selected ?
        LD   (@pscl+3),A ; slot #3
        LD   DE,?odcrt
        CALL NZ,?jsr65   ; t 1
UCENT   equ false     ; No/User-defined driver
SCENT   equ false     ; Standart list driver
CSPOOL  equ true      ; Spooler list driver

; Slot 2
UV24    equ false     ; No/User-defined driver
TTLSER  equ true      ; TTL serial driver
SSC     e       db 0                      ; table terminator

        end
 db mb$output
        db baud$none
        db 'V.24  '      ; device 2
        db mb$in$out+mb$serial
        db baud$300
 onsole Output.  Send character in <C>
        ;                       to all selected devices

conout:
        LD   HL,(@covec) ; fetch console output bit vector
        JR   co


        ; AUXOUT
        ;       Auxilliary Output. Send character ееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееsend data to CRT

        BIT  6,H         ; device #1 selected ?
        LD   (@pscl+1),A ; slot #1
        LD   DE,?odlst
        CALL NZ,?jsr65   ; send data to CENT

        BIT  5,H         ; device #2 selected ?
        RET  Z
        LD   (qu false     ; Apple II super serial card
SIC     equ false     ; Apple II serial interface card
CIC     equ false     ; Apple II communications card
CCS     equ false     ; CCS 7710A serial interface

; Slot 3
CRT40   equ false     ; 40 column conso…‰С\]X] cф4”д•H=9MRCONINЃђУУ“ФХ d4фдхUH1%MQMRLISTЃђUVTХ TU„”иUa=MRAUXOUTЃPХ“ cфҐ5#cY@ Ч0Z -    ЂЁ  WІПЃШ!‰P@іc "в   0  ЂЁ  ?Щb@€„ЬЁ †Xђ"7*!–$hB@†m«  фы$U@@ 1U eџ!°C ЂCА†%« ЮМY°"1* DbZ°СймА>9”ёш4ЙQ° Аin <C>
        ;                        to all selected devices

auxout:
        LD   HL,(@aovec) ; fetch aux output bit vector
        JR   co


        ; LIST
        ;       List Output.  Send character in <C>
        ;                       t        title 'Configuration constants for modular CP/M3 BIOS'

        ; Rev. 02/09/88
        ; by Werner K.G. Muenchheimer, 5469 Windhagen


true    equ -1
false   equ not true


; Machine ID

IIe     equ false

; Slot assignement

; Slo db 'CRT   '      ; device 0
        db mb$in$out+mb$serial
        db baud$none
        db 'CENT  '      ; device 1
        db mb$output
        db baud$none
        db 'V.24  '      ; device 2
        db mb$in$out+mb$serial
        db baud$300
 @pscl+2),A ; slot #2
        LD   DE,?odv24   ; send data to V.24


?jsr65:
        LD   (a$vec),DE  ; store address of 6502 sub to call
        LD   (z$cpu),A   ; go do it!

?cinit:
        RET              ; not implemented.


@ctbl:
       ser terminal

KEYBD   equ true      ; No redefinition
USRKBD  equ false     ; User keyboard

; I/O declarations

v24bop  equ 0C05AH    ; TTLSER busy output port (AN1)
v24dop  equ 0C05CH    ; TTLSER data output port (AN2)
v24dip  equ 0C061H    ; TT nutzt 16K von den 16K der Language Karte im Z80 Modus.

CP/M 3 benoetigt 12.75K RAM, 9.5K werden waehrend der Ausfuehrung eines Benut-
zerprogramms benoetigt.

Im Z80 Modus werden keine Peripheriekarten angesteuert!

Die Konfiguration wird im File m CP/M 3

Die Frage nach den Gruenden fuer CP/M 3 ist eine andere als die nach dem war-
um. Die letztere muss jeder fuer sich beantworten. Die erste dagegen laesst
sich leicht klaeren. CP/M 3 wurde nach den Vorschlaegen und Wuenschen von Pro-
grammierееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееOriginalhardware von Apple, ohne Anpassung eingesetzt
werden.

Ziel dieser Implementation ist vordringlich Kompatibilitaet zu anderen Imple-
mentationen; Verstoesse gegen dieses Prinzip von frueheren CP/M 2 Versionen
wurden moeglichst vermieden, ohne ееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееLSER data input  port (PB0)
v24bip  equ 0C062H    ; TTLSER busy input  port (PB1)

cntdta  equ 0C090H    ; CENTronics data  output port
cntstb  equ 0C1C1H    ; CENTronics strobe input port
cntmsk  equ 080H      ; CENTronics strobe input mask
cntcpl  1.) Benutzer-Anforderungen

CP/M Version 3.0 soll Besitzern von Microsoft's SoftCard 1 zugute kommen. Es
ist nicht als Ersatz fuer das gewohnte CP/M 2.2x gedacht, sondern ergaenzt
die vorhandenen Betriebssysteme um das derzeit modernste Originalbetriebern geschaffen. Neben mehreren Hundert Kilobyte Systemsoftware, zu de-
ren Beherrschung Handbuecher unabdingbares Muss sind, stellt CP/M 3 die Bruecke
zum Multiuser/Multitasking Betriebssystem MP/M dar.



56K BIOS3 R6/89 Eigenschaften und Umfeld

;Submit file to build 56K BIOS3 for Apple ][,+,e with SoftCard
;
M80 =BIOSKRN
M80 =BOOT
M80 =MOVE
M80 =CHARIO
M80 =DRVTBL
M80 =DISKIO
M80 =SCB
LINK BIOS3[OS,NR]=BIOSKRN,BOOT,MOVE,CHARIO,DRVTBL,DISKIO,SCB
GENCPM AUTO DISPLAY
praktische Eigenschaften aufzugeben. Jedes
CP/M hat seine guten Eigenschaften, hier gilt wie immer das passende zu waeh-
len.


2.) Geraete-Anforderungen

BIOS3 laeuft auf Apple ][,+ und e mit mindestens 48K RAM und installierter
Language Karte undWerner K.G. Muenchheimer                                       Johannisberg 12
                                                               D-5469 Windhagen
                                                               09.06.1989



Vorwort - Waruequ 00H       ; CENTronics strobe inv.  mask

a$cpu   equ 0C400H    ; Z80 SoftCard 1 I/O select address (6502 view)
z$cpu   equ 0E400H    ; Z80 SoftCard 1 I/O select address (Z80  view)
s-
system von DRI. Zum einen soll jedem durch den Sourcecode die Moeglichkeit
eigener Erweiterungen gegeben werden, zum anderen ein grosser Vorrat an pra-
ktischen Grundfaehigkeiten ueber bekanntes hinaus. Wie auch immer kann es
auch auf der zeitlosen ееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееCONFIG.LIB getroffen; waehrend des Systemkalt-
starts findet keine Kartenerkennung statt.


Apple Peripherie-Karten:

Slot  Notwendig   Typ                   Voreintellung
0     ja          16K RAM       Karte   keine (sonst LC oder 16K)
1     neinivity Tool Reference Manual


Folgende Manuals sind im Nachdruck verfuegbar:

2. und 3.  CP/M Plus (CP/M Version 3) Betriebssystem
           ISBN 3-89090-371-1
           Markt & Technik

4. und 5.  Programmer's Utilities und SID fuer CP/M 2.2 uneropage und Stack
$0200-$037F  0F200H-0F37FH  frei (EMULA & PARA3)
$0380-$03FF  0F380H-0F3FFH  Tabellen und 6502 Hauptschleife
$0400-$07FF  0F400H-0F7FFH  Bildschirmspeicher
$0800-$0EAA  0F800H-0FEAAH  6502 Device Treiber Programme
$0EAA-$0FFF  0FEAAHim CP/M 2.20 benutzten gleich.
Der 6502 wird vom Z80 durch einen Schreibbefehl auf die slotabhaengige I/O-
Select-Addresse der Z80-Karte aktiviert. Der Z80 wird durch einen weiteren
Schreibzugriff des 6502 auf die selbe Addresse reaktiviert. Die fuer de     I   TPA   I                 Main memory
          I         I
00000H    I---------I            .....


5.) Systemerstellung

Benutzung,Installation und Generierung von CP/M 3 sind den Manuals von DRI zu
entnehmen. Dies sind:

1.) CP/M Plus (Verfuegung stehende Addresse liegt bei 56K-1. 4K
Speicher werden fuer Bildschirm und CP/M Device Treiber benutzt. Da nur 12K
von den 16K der Language-Karte direkt addressierbar sind ensteht somit ein
56K System.

Der Hauptspeicher wird zur Laufzeit ve        Parallele I/O Karte   Epson Centronics
2     nein        Serielle  I/O Karte   TTLSER ueber Joyport
3     nein        Serielle  I/O Karte   80 Zeichen Terminal Karte
4     ja          Z80 Prozessor Karte   SoftCard 1
5     nein        frei     ---I                 Main memory
          I   40Z   I
0F400H    I---------I
          I  6502   I
0F380H    I---------I
          I  User   I
0F200H    I---------I
          I  6502   I
0F000H    I---------I
          I   I/O   I
0E000H    I====-0FFFFH  Puffer
$1000-$BFFF  00000H-0AFFFH  TPA
$C000-$CFFF  0E000H-0EFFFH  Memory mapped I/O
$D000-$FFFF  0B000H-0DFFFH  TPA, BDOS3 UND BIOS3


Grafische Uebersicht:

0FFFFH    I---------I            .....
          I  DEV65  I
0F800H    I------n Z80
gueltige I/O Addresse ist fuer den Z80 in der Addresse 0F3DEH vermerkt. Zum
Aufruf eines beliebigen 6502 Programms koennen notwendige Registerinhalte und
die Startaddresse des Programms in den 6502 Monitor-Zwischenspeichern bzw. der
Addresse bei CP/M Version 3) Operating System System Guide
2.) CP/M Plus (CP/M Version 3) Operating System User's Guide
3.) CP/M Plus (CP/M Version 3) Operating System Programmer's Guide
4.) The Programmer's Utilities Guide
5.) Symbolic Instruction Debugger Productrschiedenen Teilen des Betriebssystems
zugeteilt, sowie Erweiterungsprogrammen mit wahlfreier Installation durch den
Benutzer.


Speicherbelegung:

    6502          Z80
  Adresse       Adresse          Nutzung

$0000-$01FF  0F200H-0F1FFH  6502 Z             Saturn 128K RAM Karte
6     ja          Disk      I/O Karte   Disk ][ Kontroller Karte
7     nein        frei                  HD und WD1770 FD Karte


3.) Prozessor-Protokoll

Aufruf von 6502 Subroutinen:

Die Aufrufprozedur ist der =====I            .....
          I  BIOS3  I
0D900H    I---------I
0BFFFH    I  BDOS3  I I========I      LC memory
0BA00H    I---------I I Spool  I
          I   TPA   I I  CCP   I
0B000H    I=========I I========I .....
          I         I
          Z80        6502
Register  Addresse   Addresse

A          0F045H     $0045
X          0F046H     $0046
Y          0F047H     $0047
P          0F048H     $0048
S          0F049H     $0049


4.) Speicheraufteilung

Die hoechste dem BIOS zur 0F3D0H angegeben und erhalten werden. Saemtliche 6502 Register
sind ansprechbar.

Waerhrend der Ausfuehrung eines 6502 Programms sind stets die ROM's aktiviert,
sonst die 16K-Karte bzw. Language-Karte.

Die Monitor-Register-Addressen sind:

  6502 d CP/M 3 (Plus) in
           englischer Sprache
           ISBN 3-89090-372-X
           Markt & Technik


Kurzuebersicht zur Systemersetellung:

Zur Systemgenerierung werden folgende Programme/Files benoetigt:

M80     .COM (aus MS  ALDS-Paket,

     46K TPA


    CP/M Version 3.0, 56K BIOS R6/89

    A>_


Wenn die Meldung nicht erscheint ueberpruefen Sie die korrekte Positionierung
von Karten und der Systemdiskette. Unterschiede im Verhalten des CP/M 3 zu
diesem Zeitpunkt sind steteistet.
Kopieren Sie die Dateien CPM3.SYS und CCP.COM auf die formatierte Diskette.
Starten Sie das Programm PUTSYS von ihrer Systemdiskette mittels:

 PUTSYS <RETURN>

Das Programm fordert Sie nun auf eine Diskette mit den Dateien BOOTLDR.COM und
Ciles:

1.) Assemblieren Sie folgende Files:

    M80 =BIOSKRN .MAC      -> BIOSKRN .REL
    M80 =BOOT    .MAC      -> BOOT    .REL
    M80 =MOVE    .MAC      -> MOVE    .REL
    M80 =CHARIO  .MAC      -> CHARIO  .REL
    M80 =DRVTBL  .MAC      -> Dner ein und legen Sie die Systemdiskette in Laufwerk A. Der BOOT
findet jetzt automatisch statt.

Wenn Sie einen Apple ][ ohne Autostart ROM benutzen schalten Sie ihren Rechner
ein und legen Sie die Systemdiskette in Laufwerk A. Druecken Sie die 'RESET der unter CP/M 2 lauffaehiges Kaltstartlader des CP/M 3. Kopie-
ren Sie die Files BOOTLDR.COM, CPMLDR.COM, CPM3.SYS und CCP.COM auf eine forma-
tierte Leerdiskette und starten Sie CPMLDR.COM mittels:

    CPMLDR <RETURN>

Nach Erscheinen der Systemm 6502 faehige Ausfuehrung)
LINK    .COM (von DRI System-Diskette)
GENCPM  .COM (von DRI System-Diskette)
CCP     .COM (von DRI System-Diskette)

BDOS3   .SPR (von DRI System-Diskette)
CPMLDR  .REL (von DRI System-Diskette)

Zuerst:

Fertigen Sie n Systemdiskette geschrieben werden. Wenn Sie mehr als eine
Bootdiskette erstellen wollen, koennen Sie die Wiederholungsfrage mit 'Y' fuer
'Ja' beantworten. PUTSYS wird nun ohne Neuladen sofort weitere formatierte Dis-
etten mit dem Kaltstartlader beschPMLDR.COM in das aktuelle Laufwerk einzulegen. Geben Sie anschliessend RETURN
ein. PUTSYS wird nun die notwendigen Files von Diskette lesen und Sie zum ein-
legen der Zieldiskette auffordern. Nun sollte der Kaltstartlader auf die Sys-
temspuren der neueRVTBL  .REL
    M80 =DISKIO  .MAC      -> DISKIO  .REL
    M80 =SCB     .MAC      -> SCB     .REL

2.) Linken Sie die REL-Files mittels:

    LINK BIOS3[OS]=BIOSKRN,BOOT,MOVE,CHARIO,DRVTBL,DISKIO,SCB

                           -> BIOS3    .SPR

'
Taste und geben Sie 6 Ctrl-K RETURN ein.

Nach einigen Sekunden sollte die Systemmeldung auf dem Bildschirm erscheinen:


    CP/M V3.0 Loader
    Copyright (C) 1982, Digital Research

     BIOS3    SPR  D900  0500
     BDOS3    SPR  BA00  1F00eldung koennen Sie eine bootfaehige CP/M 3 System-
diskette erstellen.


6.) Erstellen von Systemdisketten

Formatieren Sie eine neue Diskette mittels des Ehring Programms FORMAT.COM.
Die einwandfreie Funktion anderer Formattierer ist nicht gewaehrleine Kopie ihrer Originaldiskette an und verwahren Sie diese an
einem sicheren Platz. Arbeiten Sie nur mit einer Kopie. Sie sichern sich so
immer einen zuverlaessigen Ausgangspunkt fuer eine Neuinstallation auf ihrem
Geraet.


Erzeugen des CPM3.SYS Freiben. Wenn Sie keine weiteren Systemdisket-
ten erzeugen wollen beantworten Sie bitte die Wiederholungsfrage mit 'N' fuer
'Nein'.


6.) Booten des CP/M 3

Wenn Sie einen Apple ][+ oder Apple //e mit Autostart ROM benutzen, schalten
Sie ihren RechFile mit CPMLDR.REL mittels:

    LINK CPMLDR[L100]=CPMLDR,LDRBIOS

                           -> CPMLDR  .COM

3.) Linken Sie den Bootsektor mittels:

    LINK BOOTLDR[L100]=BOOTLDR

                           -> BOOTLDR .COM


CPMLDR.COM ist3.) Linken Sie den SPR-File mit BDOS3.SPR mittels:

    GENCPM AUTO DISPLAY    -> CPM3     .SYS


Erzeugung des Systemladers:

1.) Assembliern Sie den File LDRBIOS.MAC mittels:

    M80 =LDRBIOS .MAC      -> LDRBIOS .REL

2.) Linken Sie den REL-s auf Aenderungen an der Originalimplementation zu-
rueckzufuehren. Zu Schaffung einer einheitlichen Basis ist hier die Anforder-
ung einer Originaldiskette anzuraten.


7.) Terminal-Benutzung

Eine Terminal-Interface-Karte muss in Slot 2 oder 3 ins
laufen in der Regel ohne Aenderung. Dies gilt im absoluten Sinne fuer kommer-
zielle Software. Arbeiten Programme unter BIOS3 56K fehlerhaft, kann als sicher
angenommen werden, dass sie auf keinem CP/M 3 System arbeiten. Programme des
Apple ][ CP/M V2.h ein physikalisches Laufwerk unter ver-
schiedenen XDPH's zu benutzen, also mehrere Formate pro Laufwerk zu fahren.

Das Vorhandensein eines Laufwerkes wird ueber einen Link im Modul 'DRVTBL.MAC'
dem BDOS3 mitgeteilt und ist hier bei weiteren Laufwerkstarten Sie den Emulator mit 'EMULA <RETURN>'.
Sie koennen dann zur Laufzeit mit den vorgegebenen Files DATAM.MAC, HAZEL.MAC,
SOROC.MAC, KEYBD.MAC und VIDEO.MAC oder selbst erzeugten Files die gewuenschte
Emulation auswaehlen. Mittels Vorbesetzung im FiC' in dem saemtliche zeichenorientierten Devices ver-
waltet werden. BIOS3 unterstuetzt binaere Devices bislang nicht.


13.) Xon/Xoff Protokoll und Baudtratenwahl

Das im Altos BIOS von DRI verankerte wahlfreie Protokoll und moegliche Baud-
ratenwad
Konstanten fuer die Installation groesserer Laufwerke im BIOS unter Verwendung
eines FDC4 oder Ehring-Kontrollers, bzw. IBS AP53. Die im Grundzustand nicht
benoetigten Tabellen XDPH's sowie DPB's sind durch Kommentarzeichen von der
Assemblierung ausgtalliert werden. Sie
darf Status-Abfragen unterstuetzen. Fuer Slot 3 steht zusaetzlich ein exter-
ner Emulator zur Verfuegung. Statusabfragen werden in der Grundeinstellung
nicht bedient. Fuer einen vollstaendige Nutzung des Ein-/Ausgabeumleitung im
CPtellt die notwendige Schnittstelle fuer eine eventuell vorhandene
Hardware-Uhr dar. Fuer Verwaltungszwecke ist die Softeware-Uhr ausreichend.


12.) Maus, Paddles u.a.

Steuerelemente anderer Art als Tastatur werden von CP/M nicht genutzt. Fehlen-
den, wie C usw. zur Ver-
knuepfung von BDOS3 und XDPH's einzutragen.


11.) Uhr

BIOS3 unterstuetzt eine nicht hardware maessig gestuetzte Uhr mit Sekunde, Mi-
nute, Stunde, Tag und Jahresangabe. Die BIOS3 Schnittstelle '?time' im Modul
'BOOT.MAC' sle 'BOOTLDR.MAC' ist eine schon
beim Boot des Systems erfolgende Voreinstellung moeglich. Die Einbindung von
eigenen Zeichenteibern zur Laufzeit ist ueber eine Sprungleiste fuer 6502
Device-Treiber moeglich.


9.) Einbindung von eigenen Treibern ins hl wird im BIOS3 56K nicht unterstuetzt. Die Vorgaben im Device Chara-
cteristics Table sind gegen Aenderung durch 'DEVICE.COM' gesichert.


14.) Programm-Kompatibilitaet

BIOS3 56K ist eine standartmaessige Implementation, d.h. reine CP/M Programmeenommen und zur Verwendung von diesen zu befreien. Zur Ein-
richtung notwendige physikalische Konstanten fuer Trackzahl der Laufwerke, die
Steprate und 40 Spur Emulation auf 80 Spur Laufwerken, sind in Tabellen vorge-
geben. Unter anderem ist es moeglic/M 3 BIOS ist eine eigene Ergaenzung sinnvoll.


8.) Terminal-Emulation

Auf ihrer Systemdiskette befindet sich ein Terminal-Emulator zur Emulation von
Terminals und Tastaturumkodierung entsprechend CP/M 2.20. Falls Sie diese Faeh-
igkeit brauchen, e Anwendersoftware und Inkompatibilitaet zu aelteren CP/M Versionen laesst
Treiber hier ueberfluessig erscheinen. Grundsaetzlich kann aber ein zusaet-
liches Device dieser Art ohne Problem im CP/M verankern. Der Ansatzpunkt ist
hier das Modul 'CHARIO.MA in der Leiste vor. Als Zielspeicherbereich steht, sofern nicht an-
derweitig belegt, der I/O Patch Bereich von $0200 bis $037F zur Verfuegung.


10.) Groessere Laufwerke

Das BIOS3 Modul 'DISKIO.MAC' enthaelt die notwendigen Organisationstabellen unBIOS

Z80 Treiber koennen stets zur Zeit der System-Assemblierung ins BIOS integriert
werden. Zusaetzliche oder alternative 6502 Treiber sollten ueber die Sprung-
leiste eingebunden werden. Die Einbindungsprozedur sieht einen Austausch der
Sprungziele2x sind zum Teil auf das Betriebssystem und damit verbundene
Tricks zugeschnitten. Diese Programme sind auf anderen CP/M-Rechnern oder CP/M
3 nicht lauffaehig. Beispiele hierfuer sind MFT.COM, FORM.COM, CONFIGIO.BAS
und DPARMS.COM. Volle Kompatibilitaet2{БН&ЙГ“БНҐРГ:К*€ЦГГУ:ЖЦГЛАл"ШШГRЖНЂР*њЦГГУ*†ЦГГУНКНҐРНqКГИНЂР*Ц"zБЙ:ГЦюяВХУ:аШГЛАж2аШЙН¬РНЊДГОПН¬РНЊДГЧПН¬РГ(Рл}/_|/*€Ц¤W}Јo"бШН6Жб"бШс!_ЖеКЌИ:еШOНsИГ™И*гШ"ЫШцГОТНҐРГcЙН¬РНЊДГґМН¬РНЊДГ­ННЕНЕНҐРНКНКЛНЎКН”Ж·К`УН-ИѕТ}УхсФЭЛН”ЖИНяЕPН¬Т НЗСАНyСГЎН>OНТЩНЧЪ	1КЩН”ЩН ЫГ >Г2  2 !Щ" *юШ" Н!Ь Н!Ь	Г!Ь                !)ЬЙ!BЬЙ~·ИOеНЩб#ф!±ЪНТЩ:ауЖAOНЩ!ГЪНТЩ*вуНЪ!ИЪНТЩ*ГcЩГ€ЩГvЫГАЫГфЫГюЫГщЫГЕЫГ@ЪГ ЪГCЪГHЪГMЪГ\ЪГaЪГљЫГRЪГђЫГ{ЫГ•ЫГКЩГ(ЬГОЩГѓЪГ€ЪГqЫГЫГНЩГНЩГuЫГ  Г  Г  !  "ВШ"ДШ)"ЖШ)"ѕШ"АШ1КЩН”Щ!ЉЪеееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееелДЬК:ДЦ·МЬК НЇХл~жw#w#6 ##НхБН-ЗГaХНюД	л*ЫШ	Й НЇХ~ж?GёА++NНИИѕЙ<!ЕЦ4КЬХ‡5Н‚ГO 	>№Иp#ГжХН|РНmСГЛАНҐРНКНZДеo‡…! Щ…oг#~бгЙл*ЛјщлЙНҐРНКяН ПВ&ЙНюД НаПНхГНРЪ&ЙІК&ЙНжДН>ЖНиСН‹ИКИН№ХЪdХх Н-ЗсКjХНюД6еНљШН>ЖН™ИГFХНДНbГНУХН-ИѕwхНД~<с|Д·ЫАЛlИ'*АШ*ДШ*ЖШ>яЛ$!Ь·ЫИЛ$Ь·ЫИЛ$РН!Ь:HрџЙ*ѕШ*ВШЛ|Д·ЫД!Ь:{цАЛlД·ЫД!Ь:zцА|ж  Ч>Й*АШ*ДШ*Ж7!  °0лЂ2‹ан°2ѓаЙy2куфШнC>рХ0Н!ЬСЙ
BIOS Error On A: No CCP.COM file CCP     COM                        лн°лЙ*ѕШ*ВШЇЛ besteht z.B. bei WORDSTAR.COM, TURBO.COM,
FORMAT.COM, MBASIC.COM u.a. .
rn oder CP/M
3 nicht lauffaehig. Beispiele hierfuer sind MFT.COM, FORM.COM, CONFIGIO.BAS
und DPARMS.COM. Volle KompatibilitaetЦ6я>Г‹Ч<wЇНвЧНСЧНхБ6 :ыЦ<Ђ !Ђя=В Чл*ЉЦсюВґЧ"ЊЦЙл*ШШЂ юКKЩлНKЩНЪЧ6яЙ:µЦG/OЙ*ьЦМЦЙ *ьЦЙхНКВс=КjВф_ВНЪЧ##юЦГхБ     * ЦхНКЧ:НЦ_ 2ыЦ{Ў2НЦ"ьЦН+Ж"ЉЦНСЧ~<КjЧсхюТ5ЧНлБК–ЧЇНЪЧюКBЧ~·КjЧ6 *НЦе:ПЦхНСЧлНхБ!ЛЦ:МЦѕДiР>МвЧБСНБВНЂРсюРхюВ~Ч!№Ц:ёЦѕТ€Ч*ь                        єЇЙ     1                    O                   я       $  њШЂ               яяя       @     Г{єє                                                                                                                                Ю$   Щ          Copyright (C) 1982, Digital Research      Њ                                                                     
 BIOS3    SPR  D900  0500
 BDOS3    SPR  BA00  1F00
 
 46K TPA
$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$qВ*€Ц>=)ТЇФхе_Н|Р:ЯШю0К ФНЗГЄФНєФ:ГЦ<В­ФНЖбс·В‡ФЙНHЩНqВ:µЦ·И>ГЧл~юcРл!њШ…oл#~ююТЯФл^#VлГГУG#~И#~Й!Хеле##N#F#^#V#~#foг~_*†Цл"€Ц}Јo|ўg"†Ц>я2ЛЦЙ{·К&ЙюЃТ&Й2жШЙ{2зШЙН|Р*њЦлН†З  ·КDФТ<ФГ8Ф+}ґВ7Ф*ЄЦ#}‘o|g:§ЦOЇНВБл*ЉЦs#r#wЙ!іШ~цЂwВИј~ц@wГИјН6СНHЩНfoйy2иуЙЇЙ

CP/M Version 3.0, 56K BIOS R6/89

 
BIOS Error On  : T- H, S- !*ЫНТЩН	ЩЇ2mЫMЫН <(и Н Ђ,Н MЫН Їдуе|Н	Ъб}хНЪсжц0ю:8ЖOГЩy2ау !BЬ		~#foґИЛШл!ъяN#FЕbkЙ  нCвуЙнCдуЙнCжуЙi`zіИn& Йъяшя*ау& )BЬ^#Vkb+~2йу+~2бу	~#ееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееzБ}DЙе                                                                     яя                       #cdfg !"()       Н†ИИН‚Г НbДе Н§С·ВЦСлГхБб ГbД!фШНBЦ6 яГNЩ НNЩ!фШлНBЦГЛАГхБ! єлГхБzЈ<*¬ШКГУл"¬ШЙ!яя"zБ:ЭШ·К{Ц*ЫШ:гЦw :ЧЦ¶w*Лјщ*–Эяя 
ЭЭYЭYЭa\нЬ          ЛЬОЯѕЯЉЭ–Эяя  ЭэЬYЭYЭP             ЬЬ  ЪЯЉЭ–Эяя     / А   Ђ   ? А  Ђ   	
ЇШyЛ|2{ц$Д!ЬЛt2yцД!ЬЛlИ2zцнSРу2 дЙCRT    CENT   V.24   lЬЏЬ                    ІЬ      
ЭЭYЭYЭ`\нЬ          ЛЬІЯўЯЉЭ/Abort ?  я         ўЭя         ўЮ Ђ@ђ	 ’ Ђ Ђ                   ’$                „ ! @! A Ђ       D @ЁЂ U>'Ї>*2ку·ДZЭН!Ь:ку·МZЭ:лу·И:зШ<()ХНЮЩ!kЭНТЩ*куНЪ!qЭНТЩН	ЩхOНЩсСж_юR(ЕЦIИ:лужЙХ*жу я л н°СЙH, F- H, Retry/IgnoreНД~<ВЊТwб:ЧЦТ§Т*ЫШ
 ~жЂВ§Т2ЧЦГ&ЙНяЕ@НЗСМtСђШГЖДН¬РНяЕН–ДНЛ:zБ<ИГґФлЇх~ю?ВаТНЂРНрР ГфТНэГ~ю?КпТНЕНЕНҐРсхКУ*бШе>ьҐЕН†ИДyСЇ2zББбp##qЙ:ЎШГЛА!яяНфУЇ2ЪШ!Ђ "ШШГRЖН|Р:ЖЦ2ЪШЙНЕНҐРНК:аШ·КNТ>ю2аЦ<2бЦНЎКН|Т!бЦѕИw:аЦююИНСЛ>Ђ2ЧЦ*ЫШ6 НsИН™ИН¤КН|ТЙН”ЖИЂЙ*ЫШ ЙН‚Г	:ЕЦ·КГn`Й	~#foЙНbГ2ДЦO НЉГ"НЦ}ґЙ:§ЦO*НЦЇНВБ"НЦ2ПЦ"УЦ:ЁЦO:КЦЎG2ёЦ!НЦ¶wЙ*ЫШ ~‡хzWсw+ВЯГzЙНэГ#~Й*ЫШ! Й*ЫШ|љyЪГг#геГчВге*ҐЦН°БбХЕел*ІЦDM"юЦНЩС*ђЦs#rБС*’Цs#r#pБy“oxљgН[ГDM*їЦлН0ЩMD" ЧН!Щ*ЉЦMDГ$Щ:ґЦOГiД!§ЦN:КЦ·ВiГG>–O:ИЦКЂГ·ГwГИГlЙН‹ИКИНюД6еН>Ж Н-ЗНљШН™ИГ‡ЙPY*ЄЦ{•zњТЦЙЕХBKНкЖТОЙСБy°КўЙХЕНкЖТОЙБСГўЙ<НЗбСЙy°ВєЙ!  ЙЂНшЙК>Ж~ ЕGж°wБ#ГеЙХ *ЫШ	#DЙЇ2бЦxБ·В™И#ГПИЇ2ВЦ2zБGЙж?ЙНSЙНќЖ>яGГЛАx·В™И~·В™И:бЦ·К™И2вЦГЙ°Б™ИЕА##~·АН[Йе*ЯЦ$ВaЙ*бШ"ЯЦбЙНЦГШН‹ИИК„ЙНжД*ЫШН!КК~ЙГЉЙН™:zБ<КЙПНКЛ! еVq##~_Хж@°wНЎК:zБ<ВёПСбБЕеХ.КВПНЭЛ.КВПББНяЕБЇГЛАСгr##sбБ}ГЛАяН ПМґМЙ Н ПМ­НЙлN ! ~жЂЃO> €G~жЂG! ~‡‡Е*ЫШл!! ~жх~#~жO~жр#¶G~жьб.|ВЙП!  w:ЯШюcК‡ПХН„ЖСКwП! x–ж?ВwП! ~№КЅПНИВwПЕН-ИБ№ТlПСХВlПСГПАqOНфКНДКГЅПЕХНЛСБ.ДГфУѕwИ*–Ц>¶wЙwЙ:ЖЦ†ЦНЙД*¬Ц#л*ЋЦs#rЙ*ђШНЫДИ’ШГЖД:±ЦжЂА!дЦ:ЯШG~ёИ#·ВАЕ<Й*–Ц#~·Й!dЦе!сЦНјЕК·Д!шЦНјЕК&ЙбЙ!ЮШ~·И6 НЂР!  "бШЇ2ШЦЙ*Ц:ШЦ…oР$Й*ЫШ ~ЙН	Е6 ЙНэГ~жwЙН	ЕцЂwЙ*бШл*ЋЦ{–#zћЙН'ЕШr+sЙ{•ozњgЙю*¶Цл*°Ц|жgН=ЕРЕНvД*љЦл*¶ЦБК„ЕКЏЕѕИНШДАНЖ>я2ЮШ2њШН¦ЕНГїЛwЕ 	л	БК ЛКЎЛѕЪ Л·ВЎЛНЬКлwНюД ~жwН ЕН2ЗГ>ЖНyЖГ&ЙѕАлѕлАЙ!яя"ЯЦЙ*ЯЦ>ьҐo+"бШЙ!ЯЦН—ЖДСЛ*ЫШе!…Ц"ЫШНsИН™Иб"ЫШИ wбЙЇ2zБНШДАН	ЕжЂАН„ЖК№ЛН-ИOFЕqНфКyёЬДКН3ЛНэГБNpГДКН†ИИ НЇХ:ЕЦ·КZЛ~·ВMЛw·ВSЛ~ѕВ№ЛГoЛНжКлНжКлѕВ№Л#ѕВ№Л#В?Ллмя	еН-ИСН>ЖХфШеХ НNЩНлБСбВхБбЙНюД	ОАХГ„С:бШжюИG*ЊЦ` ~Ц!Аx‡_‡‡ѓ<Ѓ_ЇЙНХСА*”Цy¦ВШД<Й:©Цца/GНэГ~ А##~ж?Й НЛСАН	Еж@АНэГF6 е##N6 6 НЖ*бШеНLВНќЖ НЄЖ!ЮШ~·К+С6 б:ЯШю0ИНсЕГСЕН'ЕЪСб"бШЙ!рШ~·И6 *€Ц>=)ТXСхе!ЛЦНfРН_СДьРбс·ВCСГЂР* Ц}¤<И ~·Й*”Ц~жЙ Г{СН§С·Аб#БГXЗ*ЄЦНiД#ЙНКЕ6 НЖНЖН†ЗDM*њЦ6 #x±ВЈЗ*”Цw*®Цл*њЦs#rНLВ*ЋЦ6#6 НќЖ*ўЦ"УЦяН¤ЖН”ЖКЗНюДл*УЦ|Ґ<лДљШ>!ѕКОЗ>еѕКОЗ> ѕК
И>¦ВИВюЖЙХНкЖжюБ±ВЗwЙ:уШШхН†ЗDM*њЦT]	сКKЩлГKЩЕНNЗБ:уШж@АЕН†Зл*њЦБе"њЦНNЗб"њЦЙНюД ЕСИХ:ЕЦ·КkЗЕеN ГqЗЕN#Fеy°КЂЗ*ЄЦ}‘|ФЗ>я2ВЦЙГЌИНsИНќЖНіЕМLВЇ2вЦНљШВ Й Н¤ЖН”ЖК Й*гШлюеКАИХН'ЕСТ ЙНюД:еШO ~юеМSЙy·КЙю?КЙxюКЙюКфИюМЙ–жВ-ЙГЙЕNНИG:вЦ<КНNЗН4ЕГОЗ ~*”ЦwГИ:ВЦГЛАЕх:©Ц/Gy Oс ‘жБЙНДAЕБЇ+ѕВBИВ8Иy2ДЦ:ЕЦ·xВOИЕеo& :§ЦW>’OНiДE:©ЦёбЪ5ИНэГN/жЎ°БЙ*ЫШ"гШy2еШНљШ|ОWВ|О*УЦ"НЦЕНЖНКВБНjВ*НЦСХ:ЁЦҐ ВЊОбб"НЦНRЖС:КЦWХННЪвОКИО>НЧГвОНRЖНКВНЖБЕ:НЦ!ЁЦ¦КЯО НjВБx!ЗЦѕЪпОw4ВчОНљННЎНМљНГ@ДЦ  ·КОOНЉГDMН Й}ґВО>ГЛА"НЦ"»ЦЇ2№Ц:МЦ2єЦл*ЫШ 	:ЕЦ·:ДЦКEОНЕsГMОO 		s#rЕН°Г:ЯШю(В±Оy==В±ОБх*НЦе!µЦ^WХ*ћЦ=2№ЦwНXЖСХЇw#т#ВДЁGВ|ДЙНпГ*–ЦѕДЎД:ЧЦ·И*ЫШЇwЙ*ЫШл*юШН=ЕТµД*’ШНЫДИбб>
ГЛАИ)ГЅД€Ц:ЛЦO! НјДµґЙ*†Ц:ЛЦOНiД}жЙНюДНрДРГЃБ	 ~ЙНШДИГ|Б*Њ Й*ЫШ ЙНДл! ЙНД~2КЦл~·В+ДН-ИOНДК~юЃЪ2Д>Ђ2ЗЦНэГ:©Ц¦2ИЦЙНД:КЦw:ЯШюТPД4л~юЂР:ЗЦwЙНэГr##rЙp#ИГbДИ|·g}oГjД*ЊЦ  Ї†шЙНхБ:ХЦж@К•КеНД~б#wН>ЖН™ИКИГ{КН†ИИН Е_е++VХНюДл*ЫШ НхБН-ИOСбs++r л! ‘КЩКxТЧК>Ђ¶wЙ~·А6 :ДЦ·И6ЂЙ~#¶+Аw#w+Йе ~юЃЪЛж~Ц$МК+лНюДБЙіШцЙ*ЫШН!КА>	ГУ#>?–жИВ#К·Й*ЫШ~ 	wЙНКН0К"гШНК*гШНyИНђИВ}УН0КН‹ИИНжДНЯЙНљШН™ИВ^КГИНЦГ2ХЦН‹ИИ Н:ЖЦ!ЛЦѕВЌРюяАНfРИНђЗ*–Ц~жх†wсД¦ЕНГДЙЇ2ЧЦГГРЂ*ЫШ л#~ 2ЧЦ~ЎwНЕ!  "ЯЦЇ2бЦ=2ЭШ*ЫШ~2гЦж=2ГЦюяКжР2ЖЦНЂР:аШ*ЫШwНіЕМЖНьРГ6СНКЕИ‡‡·ЂGх~жoс> ЌЙ_y–W#xћ#хІWс{ћЙs+p+qЙНхГеr#r#rН‹ИКSРНюД НаПбеНРФ"РН™И> 2zБГ4РбЙл  НаП!! q#p#wЙ2МЦwW*€ЦНЫД_ХНяБбТ†Б-Й!ЖЦsw#wЙН‚ГГ—ЖН„ЖАб>	ГЛА!бШ~#ѕА<Й!яя"бШЙНЄЖГЬЖ*¬Цл*бШ#"бШН=ЕЪќЖ:бШж‡ВВЖ2ШЦ·АЕН6ЖБ:ЮШ·АГFЕНМЖ:ЮШ·ИНСЕНйЕГ6Жyж<_W`iНiДDM*њЦ	~–ЦNНпГqЙ* ЦГЖ* ЦГЖ*ћЦ}¤<ИеМЦНлБбА6яЙХ
 ^#VлСЙНіВ>ГFЖНчДНDЕ>!  "»Ц*ћЦНЧ*ШШГ[ЖН+Ж"ЉЦЙ*ЊЦл*ЉЦЂ НKЩ!zБ~<И:бШжwЙН Е##>яДЇ2КЦГЛАН	Е:ЙЦw++~=жwГПА4Н-ИOѕТ«М5:БЦ<КПА4НфКНДКГ{МНЉЖ>я2БЦНД:КЦ!ЗЦѕЪШМюЂВПАН3М:zБ·ВПАНћГКПАН°ГННЪ@ДВцМНRЖНКВН_ВГ@Д!  "»Ц>Нr#~хеж?w#>r#ВМ=JМ§С·
КМН4Е   НбЙбсwНљШГ ЕНэГ~OНИК™МеЕНЛБб:zБ<И>Ўw##~2ЙЦВ_М4~ж?К€МНКЛН†ИВxМ:БЦ<К€МНЭЛК€МГ{МНҐКНяЕНБЦ·КЊННєФНRЖсgН[Г|юOДEЩЇЙН	ЕжwЙН	Еж@х~ц@wсЙ> 2БЦНчД:ЧЦ·>ВУ*ЫШНйДНЉЖНиСНД:КЦюЂЪЭНН3М:zБ·АНћГКыН!МЦєЦНлБКцН>я2№Ц ГOОНbГ2ДЧГ@Д:ёЦG:µЦO х:ЅЦюЪН=2ЅЦс7АЇЙсК)Нy·ИцЙy/W!КЦ:ѕЦюЪ#Н†юЂЪ?Н>ЂЕF6Еех:ЁЦ_/ Gб:БЦ·К^Н:ЗЦўјЪ_Н|ђO»ЪfНKyбБpБ!ѕЦVђєТuНWy/ў2ЅЦК&Нх:ЌБ<А*€ЦНЫДИНpЕб:ЯШю0И!МЦ:ЖЦѕВ®ВНСЕ:ЦЦ·АГЌБЇ2ЮШЙ*бШНiД"¶Ц л!НЦs#r#pЙ*ђЦN#FЕ*’Ц^#V#F*НЦ:ПЦO}“|љyеТчВ*ҐЦН°Ббг+гГаВ*ҐЦН№Бб}“НЩ|µИ^#V#"ЋЦ##"ђЦ##"’Ц###"”Ц#"–Ц##л"їЦ!ЦНхБ*Цл!ҐЦНхБ*ЄЦ|!ЕЦ6я·КJВ6 7ЙНЩЇ*ђЦw#w*’Цw#w#wЙ>2ЦЦН'ЩГqВЇ2ЦЦН*Щ·ИOН‚ВyюЪЌБГ  "        output data
?mdrwts equ jmp65+39 ; memory disk driver
?fdrwts equ jmp65+42 ; floppy disk driver
?rwpd   equ jmp65+45 ; r/w peripheral data
?clock  equ jmp65+48 ; clock driver
ееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееї:ЛШ<Кeїx·КHї~+Г8АюВЁїЕx2БеНиѕЇ2БГJїюВёїеЕЇНѕБбГHїюВПїб:Б!·ШѕТ-ї5НГѕГѕїюВЫїНРѕбГ-їюВ#АЇ2БЕНРѕБбеЕx·КА#NСХzђWЕе:БєЬтѕ*єШ}ґКSЅ~#·Вї!  "єШ"јШАГSЅzіВ-ї*ШШ"ЫШ##"єШ>2ЯШ:·Ш2Б*ЫШN#еЇG2Б№ВHїЕеНїбБюКWАю
КWАюВ|ї:КШ<К€ї:БW:·ШєКHї2Бx·КyїГдїюВ“ "        output status
?odlst  equ jmp65+06 ;   "        output data
?iv24   equ jmp65+09 ; V.24       init
?isv24  equ jmp65+12 ;   "        input  status
?idv24  equ jmp65+15 ;   "        input  data
?osv24  equ jmp65+18 ;   "        output statuslБюА!ГУе*ЫШ^#VХ#^#VблеЇw# Н’ј Н’ј Н’ј Н’јН™јю:беВТ»НsјКјЦAЪјюТј<w#НsјКј ю.Кр»ю;К!јН?јВЬ»Гјбе	 	 ю;К!јї АТТ+Т5ТёТМТУ(У.У7У@У‰УЏУ•У›УўУ‘Е«У±УЅУЗУЫУдУнУUРуУОАОАдУ&ЙОАОАФ%Ф*ФgФyФДФкФ‚ФХ&ЙоХчХ&Й%Ц2ЦОАGЦPЦФАвАоАоА+БQБBБ4Б    `Б`ББГЌБ>я2ЛЦa.я"zБ:МЦ2нШ:зШ<ДыШ:ЯШюК^ЦюК^ЦГdЦ{•_zњWРЙ{…_zЊWРЙИ)ЏГГБНхГ4А#4А#4ЙНЮБлГхБНхГРЦЙНЮБГЩБѕА#ИГлБИw#ГцБJюoКБНЩГБН ѕб#БГчА    CP/M Error On  : $Disk I/O$Invalid Drive$Read/Only File$Read/Only Disk$File Exists$? in Filename$  ГЌееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееИyюВ‰ѕ5ЙюА6 ЙyНЊЅТ ѕх^НIѕсц@O:ЯШ=КЇѕ:ПШжВIѕyю	ВIѕ НIѕ:·ШжВµѕЙНЛѕ НЩГЩ#НIѕНиѕ:·Ш!БѕР НIѕГШѕНIѕ
ГIѕ!УШ
ѕИЕOН ѕБГПШТ
ѕ>ѕИxюКѕюКѕw>ЙЇwЙМ%ѕДЩЙ:ПШжВ7ѕ!ФШ>®жwЙЇЙ:ЯШ=КЩxжВЩГЩ:Б·Вrѕ:ПШжGЕ:ЯШ=ДЅЅБЕН9ѕБx·ВrѕЕ:ФШ·ДЩБy!·ШюИ4ю Р5~·
?odv24  equ jmp65+21 ;   "        output data
?icrt   equ jmp65+24 ; CRT        init
?iscrt  equ jmp65+27 ;   "        input  status
?idcrt  equ jmp65+30 ;   "        input  data
?oscrt  equ jmp65+33 ;   "        output status
?odcrt  equ jmp65+36 ; p»		^#VлН¦јБ:зШ·АГјј!"( COPR. '82 DRI 151282ЗЗЗЗЗЗЗЗЗЗЗЗЗЗЗЗЗЗЗЗЗЗЗЗЗЗЗЗЗЗЗЗЗЗЗЗЗЗЗЗЗЗЗЗЗЗЗЗЗЗЗЗЗЗЗЗЗЗЗЗЗЗИј^Ѕ ѕdАЩЩjАЋА”АљА     Њл"ЫШлy2ЯШюЪ7є!  "ЅЦ:ЪШ2ЖЦ:жШ=К7є!”є~·К7є№КНј#Г*є{2ГЦ!  "zБ"ЭШ9"Лј1мє!dЦеyю3Т\єK!мєГnєюЂТ‚»ЦbЪ&ЙюТ&Й!R»_ ^#V*ЫШлй Е!ГЛАН›Ѕ·ИНSЅГЛАН6ЩГЛАН9ЩГЛАлMDГтѕ:ПШТИА!ЕАе:БюКѕНЩ·ИН	ЩюКыЅ2БЇЙГЛАН°Ѕ2zБЙ>ГЛАzЈ<*ПШКГУл"ПШЙ!УШzЈ<~КЛАsЙл^#V#N#Fлx±ИЕеN:ЯШЏѕбБГмїе:Б·КJї!·Ш–2БНГѕ!Б5ВАГJїхx№Ъ4АсЕеНЩГJїс#wЕеOНЏѕбБ:ПШжВTА~юxВTАюКВјГHїбp!  "єШГIѕНЩГЛАy<КѓА<КzА<К€АГЩН›ЅВ&Й        title 'Equates for 6502 device driver entry points'

        ; Rev. 02/23/89
        ; by Werner K.G. Muenchheimer, 5469 Windhagen


jmp65   equ 800H     ; Base of jump table

?ilst   equ jmp65    ; LST        init
?oslst  equ jmp65+03 ;  xј·бИюaШю{ТЏјж_жЙp#В’јЙю К™јю	К™јЙеНиѕ:МЦЖA2'ББНтѕБГтѕ!эяГЕј!юя"¬ШГЩ  !  9"Ѕ1Ѕ!>ЅеНХБН%Ѕ:жШх2ѕЦНЅ·В5Ѕ:ЯШю!ФКБНЅс=ВдјgН?јВъ»БХН™јНsјбА!  ·ИюИлЙББ!яяЙбе 	Н?јВ+ј>ђбе 	wГјНsјИю ЪјъјВXјю*К]јw#·Й6?#т]јЙ	 .,:;[]=<>| е!eјѕКѓј45#ВЅюКbЅюКbЅЙюИю
Ию	ИюИю Й:Б·ВѕНЩжЙG:ПШжxЙНЁЅВ›Ѕ:Б·ВТЅНЁЅА:БюКТЅНЩжИН	ЩюВыЅ!БѕВаЅ6 Н	ЩюВсЅ:ПШжКВјЇЦИ<НѕГаЅ!БG:oЙ  ЗЗЗЗЗЗЗЗЗЗ  :ЯШO*ЫШлГ7є*ШШЂ Г/Ѕ*ШШ"ЅЙ*Ѕ"ШШГ[ЖБ<И:жШђgЙе:ЯШю!ФеБН,ЅС*Ѕщл}DЙ!Б~6 ·АГ	Щ!ЛАеНSЅНЊЅЪrЅхOН ѕсЙНЁЅАюВЃЅНаЅГb        title 'DISK ][ diskette handler'

;    CP/M-80 Version 3    --  Modular BIOS

;       Disk I/O Module for DISK ][ based diskette systems

        ; Rev. 07/17/90
        ; by Werner K.G. Muenchheimer, 5469 Windhagen

        .Z80
        
    ; Disk I/O routines for standarized BIOS interface

; disk READ and WRITE entry points.

    ; these entries are called with the following arguments:

             ; relative drive number in @unit (8 bits)
             ; absolute drive number 

        dw fdwt,fdrd,dummy,dummy
        db 061H,trk35+stp18+sstp+mod5
xdphB:  dw fdxlt
        db 0,0,0,0,0,0,0,0,0,0
        dw fdSS35,0FFFEH,0FFFEH,0FFFEH,0FFFEH,0FFFEH
        db 0

;         dw fdwt,fdrd,dummy,dummy
;         db 050H,trk35

        extrn ?jsr65 ; switch 6502/Z80

        include DEVICE65.LIB ; define 6502 subroutine entry points
        include DSKIOB65.LIB ; define disk IOB data structure

; TYPE byte density support

trk35   equ 00000000B ; 35 track drive
trk40  ,0   ; CKS
        db 3,0    ; OFF
        db 1      ; PSH
        db 1      ; PHM

; fdSS40: db 32,0,3,07,0,147,0,047,0,192,0,12,0,3,0,1,1 ; Ehring SS40
; fdDS40: db 32,0,4,15,1,153,0,095,0,192,0,24,0,3,0,1,1 ;   "    DS40
; fdSS80: db 32,0,4,15,1, UNIT (controller relative drive: slot*16+drive)
        db trk35+stp18+sstp+mod5 ; TYPE (density support)
xdphA:  dw fdxlt  ; XLT
        db 0,0,0  ; -0-
        db 0,0,0  ;
        db 0,0,0  ;
        db 0      ; MF
        dw fdSS35 ; DPB
      cseg
        org 0


    ; Disk drive dispatching tables for linked BIOS

        public xdphA,xdphB
;       public xdphC,xdphD
        public xdphM

    ; System Control Block variables

        extrn @ermde           ; BDOS error mode

    0,0,0,0,0,0,0,0,0,0
;         dw fdSS35,0FFFEH,0FFFEH,0FFFEH,0FFFEH,0FFFEH
;         db 0

        dw mdwt,mdrd,dummy,dummy
        db 050H,0
xdphM:  dw 0
        db 0,0,0,0,0,0,0,0,0,0
        dw mdSS08,0,0FFFEH,0FFFEH,0FFFEH,0FFFEH
        db 0+stp18+sstp+mod5
; xdphC:  dw fdxlt
;         db 0,0,0,0,0,0,0,0,0,0
;         dw fdSS35,0FFFEH,0FFFEH,0FFFEH,0FFFEH,0FFFEH
;         db 0

;         dw fdwt,fdrd,dummy,dummy
;         db 051H,trk35+stp18+sstp+mod5
; xdphD:  dw fdxlt
;         db  equ 00000001B ; 40   "     "
trk80   equ 00000010B ; 80   "     "
trkxx   equ 00000011B ; not used
stp3    equ 00000000B ;  3 ms step rate
stp6    equ 00000100B ;  6 ms  "    "
stp12   equ 00001000B ; 12 ms  "    "
stp18   equ 00001100B ; 18 ms  "  153,0,095,0,192,0,24,0,3,0,1,1 ;   "    SS80
; fdDS80: db 32,0,5,31,3,156,0,127,0,128,0,32,0,3,0,1,1 ;   "    DS80

mdSS08: db 128,0,3,7,0,127,0,63,0,192,0,0,128,0,0,1,1 ; Saturn 128K

fdxlt:  db 0,3,6,9,12,15,2,5,8,11,14,1,4,7,10,13      ; Skew 3

  dw 0FFFEH ; CSV    (GENCPM option)
        dw 0FFFEH ; ALV    (GENCPM option)
        dw 0FFFEH ; DIRBCB (GENCPM option)
        dw 0FFFEH ; DTABCB (GENCPM option)
        dw 0FFFEH ; HASH   (GENCPM option)
        db 0      ; HBANK  (GENCPM option); Utility routines in standart BIOS

        extrn ?pmsg  ; print message @<HL> up to 00
        extrn ?pdec  ; print binary number in <HL> from 0-FFFFH
        extrn ?pderr ; print BIOS disk error header
        extrn ?conin,?cono   ; con in and out


    ; Disk Parameter Blocks (DPBs)

fdSS35: db 32,0   ; SPT
        db 3      ; BSH
        db 7      ; BLM
        db 0      ; EXM
        db 127,0  ; DSM
        db 47,0   ; DRM
        db 192    ; AL0
        db 0      ; AL1
        db 12p    equ 10000000B ; double step
xstp    equ 11000000B ; not used

    ; Extended Disk Parameter Headers (XDPHs)

        dw fdwt   ; fd$write
        dw fdrd   ; fd$read
        dw dummy  ; fd$login
        dw dummy  ; fd$init
        db 060H   ;  "
mod3    equ 00000000B ;  330 ms motor on delay
mod5    equ 00010000B ;  500 ms   "   "    "
mod10   equ 00100000B ; 1000 ms   "   "    "
modxx   equ 00110000B ; not used
hstp    equ 00000000B ; half   step
sstp    equ 01000000B ; single step
dstin @adrv (8 bits)
             ; density support       in @type (8 bits)
             ; disk transfer address in @dma  (16 bits)
             ; disk track address    in @trk  (16 bits)
             ; disk sector address   in @sect (16 bits)
          ееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееее AND  5FH       ; shift to upper case
        CP   'R'
        JR   Z,rw2     ; <R>etry operation ?
        SUB  'I'
        RET  Z         ; <I>gnore error ?
                       ;    else
                       ; <A>bort operation

hrderr:
   :
        LD   A,1       ; set command to write
fdrw:
        LD   DE,?fdrwts


rw:
        LD   (@cmd),A  ; save I/O driver command
        OR   A
        CALL NZ,mvdta  ; if write, transfer data from TPA to DMA buffer

rw2:
        CALL ?jsr6Цу[І@  рP)jі@ 	fЂ §SНљ  hx6иЂ3@ ©=љ  <Z.bыш¤(bµ‰,ЃУ­жжІZў§3М" € .° нX4Y$Ѓ`ЂЊ- ‚‘”иr<‹Й&sqјдeђLFу‘Р@? #< э=9%:3КOРУУ“г6 э)MHШЦ3®OФPг9`эAIJ3єOФTСг8ЂI5:VcҐ aA!
: Vg   ћW† CаDNбЂшN§љЭ‰~    йФу[і/А йle)
    ; 11xxH: RNF (sector not found)
    ; 21xxH: CRC (data checksum mismatch)

        PUSH DE
        CALL ?pderr    ; print BIOS error message header
        LD   HL,fltmsg
        CALL ?pmsg
        LD   HL,(@cmd)
        CALL ?pdec     ; p   ; pointer to XDPH in <DE>

             ; they transfer the appropriate data, perform retries
             ; if necessary, then return an error code in <A>


    ; Memory-Disk driver (Saturn)

mdrd:
        XOR  A         ; set command to read  JR   NZ,mvdta2  ; read or write ?
        EX   DE,HL
mvdta2:
        LD   BC,0100H
        LDIR
        POP  DE
        RET


        ; error message components

fltmsg: 'H, F-',0
riamsg: 'H, Retry/Ignore/Abort ? ',0

        end
     LD   A,(@stat) ; return hard error to BDOS
        AND  3         ; mask extended error numbers
dummy:
        RET

mvdta:
        PUSH DE         ; transfer data between TPA and DMA buffer
        LD   HL,(@dma)
        LD   DE,0FF00H
      5    ; call I/O driver

        LD   A,(@cmd)  ; restore I/O driver command
        OR   A
        CALL Z,mvdta   ; if read, transfer data from DMA buffer to TPA

        LD   A,(@stat) ; check status and return to BDOS if no error
        OR   A
 ееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееrint error & command number
        LD   HL,riamsg
        CALL ?pmsg     ; print retry header
        CALL ?conin    ; get operator response
        PUSH AF
        LD   C,A
        CALL ?cono     ; echo it
        POP  AF
        POP  DE
       
        JR   mdrw
mdwt:
        LD   A,1       ; set command to write
mdrw:
        LD   DE,?mdrwts
        JR   rw        ; use common code


    ; Floppy-Disk driver

fdrd:
        XOR  A         ; set command to read
        JR   fdrw
fdwt…‰С\]X] U„E„aA!
XDPHM”  MJ e  Р Pi@/ёч 0,X           Z@Пчуэья?ЯПрЁ ґ ЬыЂK–,            ­ зыщююїџпзшП Y°о}А
               Ї@  щююїџпзш @ ЃАр ј А   0 Ђ  Ааш ~ `       ААђ`<БА W† CаDNбЂшN§љЭ‰~    йФу[і/А й><command>, Retry/Ignore/Abort ?

    ; F-<error><command> messages
    ;
    ; xx00H: read  operation
    ; xx01H: write operation
    ;
    ; 02xxH: WP  (disk write protected)
    ; 05xxH: RNF (track not found)
    ; 09xxH: RNF (track not seekab       RET  Z

    ; suppress error message if BDOS is returning errors to application...

        LD   A,(@ermde)
        INC  A
        JR   Z,hrderr

    ; had permanent error, print message like:

    ; BIOS Error On <d>: T-nn, S-mm, F-<error        title 'Drive table for modular CP/M 3 BIOS'

        ; Rev. 11/18/88
        ; by Werner K.G. Muenchheimer, 5469 Windhagen


        .Z80
        cseg
        org 0

        public @dtbl
        extrn xdphA,xdphB ; Floppy-Disk
;       eееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееее ; Z80 definitions

@adrv   equ iobZ80     ; (byte) currently selected disk drive
@rdrv   equ iobZ80+01H ; (byte) controller relative disk drive
@trk    equ iobZ80+02H ; (word) current track number
@sect   equ iobZ80+04H ; (word) current sector number,0               ; drives J-L non-existent
        dw xdphM
        dw 0,0,0               ; drives N-P non-existent

        end
ееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееxtrn xdphC,xdphD ; Floppy-Disk
;       extrn xdphH,xdphI ; Hard  -Disk
        extrn xdphM       ; Memory-Disk

@dtbl:  dw xdphA
        dw xdphB
;       dw xdphC               ; drive  C   non existent
        dw 0
;       dw xdphD               ; (byte) disk I/O driver error status
@mdfrm  equ iobZ80+0CH ; (byte) memory-disk init/access status

        ; 6502 definitions

adrv    equ iob6502
rdrv    equ iob6502+01H
trk     equ iob6502+02H
sect    equ iob6502+04H
dma     equ iob6502+06H
c
@dma    equ iobZ80+06H ; (word) current DMA address
@cnt    equ iobZ80+08H ; (byte) record count for multisector transfer
@type   equ iobZ80+09H ; (byte) density support
@cmd    equ iobZ80+0AH ; (byte) disk I/O driver command
@stat   equ iobZ80+0BH ;…‰Сљ]™`TED$Й@ ФЂZ -                                      ЋЂ TED$ИИ XDPHAЊЃ U„E„(ИАXDPHMњ   ћ±• Ђ‚’¬Љ‡„ И)кИЁq”°Ђ†’  end
ееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееее        title 'Equates for disk driver I/O block structure'

        ; Rev. 02/05/88
        ; by Werner K.G. Muenchheimer, 5469 Windhagen


iobZ80  equ 0F3E0H     ; Base of IOB (Z80  view)
iob6502 equ 003E0H     ; Base of IOB (6502 view)

        drive  D   non-existent
        dw 0
        dw 0,0,0               ; drives E-G non existent
;       dw xdphH               ; drive  H   non-existent
        dw 0
;       dw xdphI               ; drive  I   non existent
        dw 0
        dw 0,0nt     equ iob6502+08H
type    equ iob6502+09H
cmd     equ iob6502+0AH
stat    equ iob6502+0BH
mdfrm   equ iob6502+0CH
ns

adrv    equ iob6502
rdrv    equ iob6502+01H
trk     equ iob6502+02H
sect    equ iob6502+04H
dma     equ iob6502+06H
cееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееPRTMSG   = Y
PAGWID   = 4F
PAGLEN   = 17
BACKSPC  = N
RUBOUT   = N
BOOTDRV  = A
MEMTOP   = DF
BNKSWT   = N
COMBAS   = 00
LERROR   = Y
NUMSEGS  = 03
MEMSEG00 = 00,80,00
MEMSEG01 = 00,C0,02
MEMSEG02 = 00,C0,03
MEMSEG03 = 00,C0,04
MEMSEG04 = 00eader (XDPHs)

        dw hdwt   ; hd$write
        dw hdrd   ; hd$read
        dw hdlgH  ; hd$login
        dw dummy  ; hd$init
        db slot   ; UNIT (controller relative drive: slot*16+drive)
        db stp007 ; TYPE (density support)
xdphH:  
OVLYDTAP = Y
CRDATAF  = N
DBLALV   = N
Y
OVLYDTAG = Y
OVLYDTAH = Y
OVLYDTAI = Y
OVLYDTAJ = Y
OVLYDTAK = Y
OVLYDTAL = Y
OVLYDTAM = Y
OVLYDTAN = Y
OVLYDTAO = YD = N
ALTBNKSE = N
ALTBNKSF = N
ALTBNKSG = N
ALTBNKSH = N
ALTBNKSI = N
ALTBNKSJ = N
ALTBNKSK = N
ALTBNKSL = N
ALTBNKSM = N
ALTBNKSN = N
ALTBNKSO = N
ALTBNKSP = N
NDIRRECA = 01
NDIRRECB = 00
NDIRRECC = 01
NDIRRECD = 01
NDIRRECE = 01
NDIRREdata   register
statrg  equ 0E081H+slot ; status register
selrg   equ 0E082H+slot ; select register
rdcmd   equ 08H         ; sector read command
wtcmd   equ 0AH         ; sector write command


    ; Disk drive dispatching table for linked BIOS

RVK = A
ODTADRVL = A
ODTADRVM = A
ODTADRVN = A
ODTADRVO = A
ODTADRVP = A
OVLYDIRA = Y
OVLYDIRB = Y
OVLYDIRC = Y
OVLYDIRD = Y
OVLYDIRE = Y
OVLYDIRF = Y
OVLYDIRG = Y
OVLYDIRH = Y
OVLYDIRI = Y
OVLYDIRJ = Y
OVLYDIRK = Y
OVLYDIRL = Y
OVLYDIRM ,C0,05
MEMSEG05 = 00,C0,06
MEMSEG06 = 00,C0,07
MEMSEG07 = 00,C0,08
MEMSEG08 = 00,C0,09
MEMSEG09 = 00,C0,0A
MEMSEG0A = 00,C0,0B
MEMSEG0B = 00,C0,0C
MEMSEG0C = 00,C0,0D
MEMSEG0D = 00,C0,0E
MEMSEG0E = 00,C0,0F
MEMSEG0F = 00,C0,10
HASHDRVA = N
HASееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееCF = 01
NDIRRECG = 01
NDIRRECH = 01
NDIRRECI = 01
NDIRRECJ = 01
NDIRRECK = 01
NDIRRECL = 01
NDIRRECM = 00
NDIRRECN = 01
NDIRRECO = 01
NDIRRECP = 01
NDTARECA = 01
NDTARECB = 00
NDTARECC = 01
NDTARECD = 01
NDTARECE = 01
NDTARECF = 01
NDTAREC        public xdphH
;       public xdphI

        include DSKIOB65.LIB ; define disk IOB data structure


stp3    equ 0 ;   3 msec step rate
stp02   equ 4 ; 200 usec step rate
stp007  equ 5 ;  70 usec step rate


    ; Extended disk parameter H= Y
OVLYDIRN = Y
OVLYDIRO = Y
OVLYDIRP = Y
OVLYDTAA = Y
OVLYDTAB = Y
OVLYDTAC = Y
OVLYDTAD = Y
OVLYDTAE = Y
OVLYDTAF = Y
OVLYDTAG = Y
OVLYDTAH = Y
OVLYDTAI = Y
OVLYDTAJ = Y
OVLYDTAK = Y
OVLYDTAL = Y
OVLYDTAM = Y
OVLYDTAN = Y
OVLYDTAO = YHDRVB = N
HASHDRVC = Y
HASHDRVD = Y
HASHDRVE = Y
HASHDRVF = Y
HASHDRVG = Y
HASHDRVH = Y
HASHDRVI = Y
HASHDRVJ = Y
HASHDRVK = Y
HASHDRVL = Y
HASHDRVM = N
HASHDRVN = Y
HASHDRVO = Y
HASHDRVP = Y
ALTBNKSA = N
ALTBNKSB = N
ALTBNKSC = N
ALTBNKS        title 'WD1002 HD driver for nonbanked CP/M 3 BIOS'

        ; Rev. 06/05/89
        ; by Werner K.G. Muenchheimer, 5469 Windhagen


        .Z80
        cseg
        org 0

slot    equ 070H        ; slot offset
dtarg   equ 0E080H+slot ; DIRDRVI = A
ODIRDRVJ = A
ODIRDRVK = A
ODIRDRVL = A
ODIRDRVM = A
ODIRDRVN = A
ODIRDRVO = A
ODIRDRVP = A
ODTADRVA = A
ODTADRVB = A
ODTADRVC = A
ODTADRVD = A
ODTADRVE = A
ODTADRVF = A
ODTADRVG = A
ODTADRVH = A
ODTADRVI = A
ODTADRVJ = A
ODTADG = 01
NDTARECH = 01
NDTARECI = 01
NDTARECJ = 01
NDTARECK = 01
NDTARECL = 01
NDTARECM = 00
NDTARECN = 01
NDTARECO = 01
NDTARECP = 01
ODIRDRVA = A
ODIRDRVB = A
ODIRDRVC = A
ODIRDRVD = A
ODIRDRVE = A
ODIRDRVF = A
ODIRDRVG = A
ODIRDRVH = A
Odw 0      ; XLT
        db 0,0,0  ; - 0 -
        db 0,0,0
        db 0,0,0
        db 0      ; MF
        dw hd10   ; DPB
        dw 0      ; CSV
        dw 0FFFEH ; ALV    (GENCPM option)
        dw 0FFFEH ; DIRBCB (GENCPM option)
        dw 0FF   RRCA
        RRCA
        OR   L
        CALL wtdta      ; send cylinder msb & sector
        LD   A,C
        CALL wtdta      ; send cylinder lsb
        LD   A,1
        CALL wtdta      ; send block count
        LD   A,(@type)
        CALL wb 0FFH     ;
          db 0FFH     ; Starting write precompensation cylinder
          db 0FFH     ;
          db 5        ; ECC data burst length


          ; 20 MByte Seagate ST225
; hddpI:    db 12,32    ; Drive 1
;           db 0,0,0,0
;     dw 639    ; DSM
;         dw 255    ; DRM
;         db 128    ; AL0
;         db 0      ; AL1
;         dw 08000H ; CKS
;         dw 0      ; OFF
;         db 2      ; PSH
;         db 3      ; PHM

        ; 10 MByte Hard-Disk
hd10:   dw 272    w$c:   LD   (selrg),A  ; select controller

        CALL wtdta      ; send op code

        LD   HL,(@sect) ; calculate head & sector
        LD   DE,17      ; with sectors in MFM
        LD   C,-1
        XOR  A
rwc1:   INC  C
        SBC  HL,DE       INC  DE
          DJNZ hdlg1
          CALL rddta     ; get completion byte
          BIT  1,A
          RET  Z         ; return with no error
          LD   HL,0
dummy:    RET            ; return error


          ; 10 MByte NEC 5124
hddpFEH ; DTABCB (GENCPM option)
        dw 0FFFEH ; HASH   (GENCPM option)
        db 0      ; HBANK  (GENCPM option)

;         dw hdwt,hdrd,hdlgI,dummy
;         db slot+1,stp007
; xdphI:  dw 0
;         db 0,0,0,0,0,0,0,0,0,0
;         dw hd5,0,0FFdrv (8 bits)
                 ; density support       in @type (8 bits)
                 ; disk transfer address in @dma  (16 bits)
                 ; disk track address    in @trk  (16 bits)
                 ; disk sector address   in @sect (16 bits)      db 2,100,4,0FFH,0FFH,0,128,5


    ; disk READ and WRITE entry points

        ; these entries are called with the following arguments:

                 ; relative drive number in @rdrv (8 bits)
                 ; absolute drive number in @a  ; SPT    (68 spt * 4 heads)
        db 7,127,7
        dw 639,511
        db 128,0
        dw 08000H,0
        db 2,3

        ; 20 MByte Hard-Disk
; hd20:   dw 272       ; SPT   (68 spt * 4 heads)
;         db 7,127,7
;         dw 1279,255
; 
        JR   NC,rwc1
        ADD  HL,DE
        LD   A,(@rdrv)
        AND  1
        RRCA
        RRCA
        RRCA
        OR   C
        CALL wtdta      ; send drive & head number
        LD   BC,(@trk)
        LD   A,B
        AND  3
     H:    db 12,0     ; Drive 0
          db 0,0,0,0

          db 1        ; Maximum number of cylinders
          db 50       ;
          db 4        ; Maximum number of heads
          db 0FFH     ; Starting reduced write current cylinder
          dFEH,0FFFEH,0FFFEH,0FFFEH
;         db 0


    ; Disk parameter blocks (DPBs)

        ;  5 MByte Hard-Disk
; hd5:    dw 136    ; SPT      (68 spt * 2 heads)
;         db 6      ; BSH
;         db 63     ; BLM
;         db 3      ; EXM
;         
                 ; pointer to XDPH in <DE>

                 ; they transfer the appropriate data, perform retries
                 ; if necessary, then return an error code in <A>

hdwt:   LD   A,wtcmd
        JR   rw$c

hdrd:   LD   A,rdcmd

rter header pointed at by <DE>

; hdlgI:    LD   DE,hddpI
;           JR   hd$lg

hdlgH:    LD   DE,hddpH

hd$lg:    LD   (selrg),A ; select controller
          LD   B,14
hdlg1:    LD   A,(DE)
          CALL wtdta     ; write parameter block
           db 128,0
;         dw 08000H,0
;         db 2,3


   ; This entry is called when a logical drive is about to
   ; be logged into for the purpose of density determination.

   ; It may adjust the parameters contained in the disk
   ; parametdta      ; send retry bits & step rate

        LD   B,128
        LD   DE,dtarg
        LD   HL,(@dma)

rwc2:   LD   A,(statrg) ; wait until REQ
        BIT  0,A
        JR   Z,rwc2

        BIT  2,A        ; check C/D
        JR   NZ,rwc5

     ; 1st access ?
        JR   Z,mdsrt

        LD   A,1
        LD   (bnkprt),A  ; select bank one
        LD   HL,0F000H
        LD   BC,800H
mdini:
        LD   (HL),0E5H   ; initialize directory
        INC  HL
        DEC  C
        JR   t
                               ; bit 0 & 1 select CPU-bank 0-3
                               ; bit 2 & 3 select Video-bank 0-3

        include DSKIOB65.LIB   ; define 6502 disk data i/o block

    ; Disk drive dispatching table for linked BIOS
    LD   (DE),A
        INC  HL
        LD   A,(HL)
        LD   (DE),A
        INC  HL
        DJNZ rwc4

rwc5:   CALL rddta      ; read completion byte
        AND  2
        SRL  A
        RET             ; return status


rddta:  LD   A,(s       db 128,1  ; SPT
        db 3      ; BSH
        db 7      ; BLM
        db 0      ; EXM
        db 143,0  ; DSM (3 * 48K Byte)
        db 63,0   ; DRM
        db 192    ; AL0
        db 0      ; AL1
        db 0,128  ; CKS
        db 1,0   ееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееее        BIT  1,A        ; check I/O
        JR   Z,rwc4

rwc3:   LD   A,(DE)     ; read data
        LD   (HL),A
        INC  HL
        LD   A,(DE)
        LD   (HL),A
        INC  HL
        LD   A,(DE)
        LD   (HL),A
        INC  HL
   ve)
        db 0      ; TYPE (density support)
xdphM:
        dw 0      ; XLT
        db 0,0,0  ; -0-
        db 0,0,0  ;
        db 0,0,0  ;
        db 0      ; MF
        dw mdSS36 ; DPB
        dw 0FFFEH ; CSV    (GENCPM option)
        dw 0FF
        public xdphM


    ; Extended Disk Parameter Header (XDPH)

        dw mdwt   ; md$write
        dw mdrd   ; md$read
        dw dummy  ; md$login
        dw dummy  ; md$init
        db 0      ; UNIT (controller relative drive: slot*16+dritatrg)
        RRA             ; REQ ?
        JR   NC,rddta
        LD   A,(dtarg)
        RET

wtdta:  PUSH AF
wtdta1: LD   A,(statrg)
        RRA             ; REQ ?
        JR   NC,wtdta1
        POP  AF
        LD   (dtarg),A
        RET
 ; OFF
        db 1      ; PSH
        db 1      ; PHM


    ; memory disk driver

mdrd:
        XOR  A
        JR   mdrw

mdwt:
        LD   A,1

mdrw:
        LD   (@cmd),A    ; save command

        LD   A,(@mdfrm)
        CP   0E5H           title 'RAM-Disk driver for 192K system memory expansion'

        ; Rev. 11/17/88
        ; by Werner K.G. Muenchheimer, 5469 Windhagen


        .Z80
        cseg
        org 0

bnkprt  equ 0E068H             ; address of bank select por     LD   A,(DE)
        LD   (HL),A
        INC  HL
        DJNZ rwc3
        JR   rwc5

rwc4:   LD   A,(HL)     ; write data
        LD   (DE),A
        INC  HL
        LD   A,(HL)
        LD   (DE),A
        INC  HL
        LD   A,(HL)
    FEH ; ALV    (GENCPM option)
        dw 0FFFEH ; DIRBCB (GENCPM option)
        dw 0FFFEH ; DTABCB (GENCPM option)
        dw 0FFFEH ; HASH   (GENCPM option)
        db 0      ; HBANK  (GENCPM option)


    ; Disk Parameter Block (DPB)

mdSS36:
 ееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееее
        end
LD   A,(statrg)
        RRA             ; REQ ?
        JR   NC,wtdta1
        POP  AF
        LD   (dtarg),A
        RET
NZ,mdini
        DJNZ mdini
        XOR  A
        LD   (bnkprt),A
        LD   A,0E5H
        LD   (@mdfrm),A

mdsrt:
        LD   A,(@sect)
        LD   BC,(@trk)
        LD   HL,0F000H
        ADD  A,H
        LD   H,A
        LD   DE,(@dmaееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееее$input+mb$output
mb$soft$baud EQU 4  ; software selectable baud rates
mb$serial    EQU 8  ; device may use protocol
mb$xon$xoff  EQU 16 ; XON/XOFF protocol enabled

baud$none    EQU 0  ; no baud rate associated with this device
baud$50      EQU 1  ;  ; get data byte
        LD   B,A
        LD   A,C
        LD   (bnkprt),A  ; select target bank
        LD   (HL),B      ; store data byte
        INC  DE
        INC  L
        JR   NZ,wt
        XOR  A
        LD   (bnkprt),A  ; select TPA
dum    ; we are passed source in DE and dest in HL
        LDIR             ; use Z80 block move instruction
        EX   DE,HL       ; need next addresses in same regs
?xmove:
?bank:
        ; not implemented.

        RET

        end
ееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееее)

        LD   A,(@cmd)    ; recover command
        OR   A
        JR   NZ,wt

rd:
        LD   A,C         ; select source bank
        LD   (bnkprt),A
        LD   B,(HL)      ; get data byte
        XOR  A           ; select TPA
        LD  1800 baud
baud$2400    EQU 10 ; 2400 baud
baud$3600    EQU 11 ; 3600 baud
baud$4800    EQU 12 ; 4800 baud
baud$7200    EQU 13 ; 7200 baud
baud$9600    EQU 14 ; 9600 baud
baud$19200   EQU 15 ; 19.2k baud
50 baud
baud$75      EQU 2  ; 75 baud
baud$110     EQU 3  ; 110 baud
baud$134     EQU 4  ; 134.5 baud
baud$150     EQU 5  ; 150 baud
baud$300     EQU 6  ; 300 baud
baud$600     EQU 7  ; 600 baud
baud$1200    EQU 8  ; 1200 baud
baud$1800    EQU 9  ;my:  RET

        end
store data byte
        INC  DE
        INC  L
        JR   NZ,wt
        XOR  A
        LD   (bnkprt),A  ; select TPA
dumееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееее        TITLE 'Equates for mode byte bit fields in CP/M3 BIOS'

        ; Rev. 02/03/88
        ; by Werner K.G. Muenchheimer, 5469 Windhagen


mb$input     EQU 1  ; device may do input
mb$output    EQU 2  ; device may do output
mb$in$out    EQU mb  (bnkprt),A
        LD   A,B         ; store data byte
        LD   (DE),A
        INC  DE
        INC  L
        JR   NZ,rd
        XOR  A
        RET

wt:
        XOR  A           ; select TPA
        LD   (bnkprt),A
        LD   A,(DE)             title 'bank & move module for CP/M 3 linked BIOS'

        ; Rev. 02/03/88
        ; by Werner K.G. Muenchheimer, 5469 Windhagen


        .Z80
        cseg
        org 0

        public ?move,?xmove,?bank

?move:
        EX   DE,HL   ееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееее…IШ[љаSфФхdXэa5=Y?BANK”  MA@%  Р [µ`лdЗA )ъ
r\t џ¦§«"ЗA 1ъВjzІ,а  ћ @…ЊР( #_АБFh Ї Fв " X .°
 2Eё«’АЙ<ЊќO0     ; need next addresses in same regs
?xmove:
?bank:
        ; not implemented.

        RET

        end

        dw dummy  ; md$init
        db slot   ; UNIT (controller relative drive: slot*16+drive)
        db 0      ; TYPE (density support)
xdphM:
        dw 0      ; XLT
        db 0,0,0  ; -0-
        db 0,0,0  ;
        db 0,0,0  ;
        db 0DEC  SP
        EX   (SP),HL
        LD   (@dma),HL   ; restore DMA address
        LD   (bpnt1),SP
        LD   SP,(loc$sp)

        CALL rw$c1       ; call disk i/o handler
        OR   A           ; check for error
        RET  NZ          ; retееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееlot        ; memory card address bits 0-7
adr16   equ 0E081H+slot        ; memory card address bits 8-15
adr19   equ 0E082H+slot        ; memory card address bits 16-18
dta8    equ 0E083H+slot        ; memory card data port

        include DSKIOB65.L   BC,(bpnt1)
        XOR  A
        SBC  HL,BC
        JR   C,cnt2

        LD   HL,buffer   ; reset buffer pointers
        LD   (bpnt0),HL
        LD   (bpnt1),HL
        RET              ; return with no error

cnt2:   LD   (loc$sp),SP
     ееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееее        end
   ds 0300H         ; 16384 / 128           * 6 (=maximum)
buffer: ds 0
bpnt0:  dw buffer
bpnt1:  dw buffer
loc$sp: ds 2

urn error to BDOS
        JR   cnt1

rw$c1:  ;...
        RET

                         ; BLS   / (sector size) * 6
        ds 0300H         ; 16384 / 128           * 6 (=maximum)
buffer: ds 0
bpnt0:  dw buffer
bpnt1:  dw buffer
loc$sp: ds 2

        title 'MULTIO handler for CP/M 3 BIOS'

        ; Rev. 02/05/89
        ; by Werner K.G. Muenchheimer, 5469 Windhagen


        .Z80
        dseg

        extrn @trk,@sect,@dma,@cnt

rw$common:
        LD   HL,@cnt
        XOR  A
    IB   ; define 6502 disk data i/o block

    ; Disk drive dispatching table for linked BIOS

        public xdphM


    ; Extended Disk Parameter Header (XDPH)

        dw mdwt   ; md$write
        dw mdrd   ; md$read
        dw dummy  ; md$login   LD   SP,(bpnt1)
        DEC  SP
        DEC  SP
        EX   (SP),HL
        LD   (@trk),HL   ; restore track number
        DEC  SP
        DEC  SP
        EX   (SP),HL
        LD   (@sect),HL  ; restore sector number
        DEC  SP
        ееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееее        title 'RAM-Disk driver for OHO512K card'

        ; Rev. 11/24/88
        ; by Werner K.G. Muenchheimer, 5469 Windhagen


        .Z80
        cseg
        org 0

slot    equ 050H               ; hardware slot offset
adr8    equ 0E080H+sve sector number
        PUSH HL
        LD   HL,(@dma)   ; save DMA address
        PUSH HL
        LD   (bpnt0),SP
        LD   SP,(loc$sp)

        RET  NZ          ; return with no error

cnt1:   LD   HL,(bpnt0)  ; check buffer end
        LD    CP   (HL)        ; check direct access
        JR   Z,rw1
        DEC  (HL)        ; check all buffered

        LD   (loc$sp),SP
        LD   SP,(bpnt0)
        LD   HL,(@trk)   ; save track number
        PUSH HL
        LD   HL,(@sect)  ; sa      ; MF
        dw mdSS8  ; DPB
        dw 0FFFEH ; CSV    (GENCPM option)
        dw 0FFFEH ; ALV    (GENCPM option)
        dw 0FFFEH ; DIRBCB (GENCPM option)
        dw 0FFFEH ; DTABCB (GENCPM option)
        dw 0FFFEH ; HASH   (GENCPM option); Vector (word, r/w)
@aovec  equ     scbbase+28H     ; Auxiliary Output Redirection
                                ; Vector (word, r/w)
@lovec  equ     scbbase+2AH     ; List Output Redirection
                                ; Vector (word, r/w)
@bnееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееD   (@cmd),A    ; save command
        LD   HL,dta8

        LD   A,(@mdfrm)
        CP   0E5H        ; 1st access ?
        JR   Z,mdsrt

        XOR  A
        LD   (adr19),A
        LD   A,0E5H
        LD   BC,0700H    ; clear directory
mdiniel, @fx, @usrcd
        public @mltio, @ermde, @erdsk, @media, @bflgs
        public @date, @hour, @min, @sec, ?erjmp, @mxtpa


scbbase equ     0FE00H          ; Base of the SCB

@civec  equ     scbbase+22H     ; Console Input Redirection
         t:
        LD   A,B         ; write 256 byte
        LD   (adr8),A
        LD   A,(DE)
        LD   (HL),A
        CP   (HL)
        JR   Z,wt1
        LD   C,1        ; CRC (data checksum mismatch)
wt1:
        INC  DE
        DJNZ wt

mdrts:
        db 0      ; HBANK  (GENCPM option)


    ; Disk Parameter Block (DPB)

mdSS8:
        db 0,2    ; SPT
        db 4      ; BSH
        db 15     ; BLM
        db 1      ; EXM
        db 255,0  ; DSM
        db 63,0   ; DRM
        db 12ееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееее:
        LD   (adr8),BC
        LD   (HL),A
        CP   (HL)
        JR   Z,mdini1
        LD   A,1         ; RNF (Record Not Found)
        RET
mdini1:
        INC  C
        JR   NZ,mdini
        DEC  B
        JP   P,mdini
        LD   (@m                       ; Vector (word, r/w)
@covec  equ     scbbase+24H     ; Console Output Redirection
                                ; Vector (word, r/w)
@aivec  equ     scbbase+26H     ; Auxiliary Input Redirection
                                
        LD   A,C
dummy:
        RET

        end
)
        JR   Z,wt1
        LD   C,1        ; CRC (data checksum mismatch)
wt1:
        INC  DE
        DJNZ wt

mdrts:8    ; AL0
        db 0      ; AL1
        db 0,128  ; CKS
        db 0,0    ; OFF
        db 1      ; PSH
        db 1      ; PHM


    ; memory disk driver

mdrd:
        XOR  A
        JR   mdrw

mdwt:
        LD   A,1

mdrw:
        L        title 'System Control Block Definition for CP/M3 BIOS'

        ; Rev. 02/03/88
        ; by Werner K.G. Muenchheimer, 5469 Windhagen


        public @civec, @covec, @aivec, @aovec, @lovec, @bnkbf
        public @crdma, @crdsk, @vinfo, @res   A,B         ; read 256 byte
        LD   (adr8),A
        LD   A,(HL)
        LD   (DE),A
        CP   (HL)
        JR   Z,rd1
        LD   C,1         ; CRC (data checksum mismatch)
rd1:
        INC  DE
        DJNZ rd
        JR   mdrts

wdfrm),A

mdsrt:
        LD   A,(@trk)
        LD   (adr19),A
        LD   A,(@sect)
        LD   (adr16),A
        LD   DE,(@dma)
        LD   BC,0

        LD   A,(@cmd)    ; restore command
        OR   A
        JR   NZ,wt

rd:
        LDkbf  equ     scbbase+35H     ; Address of 128 Byte Buffer
                                ; for Banked BIOS (word, r/o)
@crdma  equ     scbbase+3CH     ; Current DMA Address
                                ; (word, r/o)
@crdsk  equ     scbbase+3EH     ееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееъ " Є"ЗІ*’"љ\q/ы "©&ў"Зяљ2Дqkъ $'Є©G
їІbzІ*qSы &ўў$ ЗяўjJtq+ы &¦*$§ЗїІjВў‚qы )"©ў¦G?ўљ*qы *©©!ўGяІІJr2|а  ћ8Q@HOURЃRS D4T8эI)5B@MXTPA”  Gя±ъ*’Rj„p›ы  ¤«"ЎЗ
?І
zІ*q_ы !#&#©ЗІrZ4p‹ы !¤«"ЎЗ	?ІzІ*pуы !©"& ЗїІ’"љ\qcS Error Mode (byte, r/o)
@erdsk  equ     scbbase+51H     ; BDOS Error Disk (byte,r/o)
@media  equ     scbbase+54H     ; Set by BIOS to indicate
                                ; open door (byte,r/w)
@bflgs  equ     scbbase+57H     ; BDOS Message Size Fееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееее; Current Disk (byte, r/o)
@vinfo  equ     scbbase+3FH     ; BDOS Variable "INFO"
                                ; (word, r/o)
@resel  equ     scbbase+41H     ; FCB Flag (byte, r/o)
@fx     equ     scbbase+43H     ; BDOS Function for Error
          ееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееlag (byte,r/o)
@date   equ     scbbase+58H     ; Date in Days Since 1 Jan 78
                                ; (word, r/w)
@hour   equ     scbbase+5AH     ; Hour in BCD (byte, r/w)
@min    equ     scbbase+5BH     ; Minute in BCD (byte, r/w)
@sec    eqееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееее…‰ФЮ\Э`d4•dT8=Y@AIVECЃђSХ‘PаdДхdT8	9-	@CRDMAЃђФ‘Таdd”дdшIM2@FXЃђTФђС dФЕD”шI5@ERDSKЃђQQP`d$dДu8Q@HOURЃRS D4T8эI)5B@MXTPA”  Gя±ъ*’Rj„p›ы  ¤«"ЎЗ
?І
zІ*q_ы !#&#©ЗІrZ4p‹ы !¤«"ЎЗ	?ІzІ*pуы !©"& ЗїІ’"љ\qc                      ; Messages (byte, r/o)
@usrcd  equ     scbbase+44H     ; Current User Code (byte, r/o)
@mltio  equ     scbbase+4AH     ; Current Multi-Sector Count
                                ; (byte,r/w)
@ermde  equ     scbbase+4BH     ; BDOееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееее7)(word, r/o)
        end
              ; (word, r/w)
@mxtpa  equ     scbbase+62H     ; Top of User TPA
                                ; (address at 6,u     scbbase+5CH     ; Second in BCD (byte, r/w)
?erjmp  equ     scbbase+5FH     ; BDOS Error Message Jump
                                ; (word, r/w)
@mxtpa  equ     scbbase+62H     ; Top of User TPA
                                ; (address at 6,ееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееее